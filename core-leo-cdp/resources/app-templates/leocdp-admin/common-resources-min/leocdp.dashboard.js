'use strict';var mainDashboardFunnelHeight=420,mainDashboardWidth=860,dashboardFontSize=14,flowNetworkGraph=!1,dashboardDataModel=!1,currentJourneyMapId="",initPrimaryDashboard=function(){window.mainDashboardFunnelHeight=420;window.mainDashboardWidth=860;window.dashboardFontSize=14;window.flowNetworkGraph=!1;window.dashboardDataModel=!1;window.currentJourneyMapId="";loadJourneyMapList(!1,function(a){currentJourneyMapId=a;showDashboardReport(!0)},!0);setupTabPanels();updateProfileChartWrapper();initDateFilterComponent(!1,
null,null,45);showDashboardReport(!0)},updateProfileChartWrapper=function(){var a=$("#profile_funnel_wrapper"),c=$(window).width();1500<c&&1650>c?a.css("width","90%"):1650<c&&1750>c?a.css("width","96%"):1750<c&&a.css("width","98%");a=$(window).height();var b=c/a;1.7<=b&&2.3>b&&1400<c&&700<a?(mainDashboardFunnelHeight=a-(Math.floor(window.innerHeight/3)+186),dashboardFontSize=15):2.3<=b&&1400<c&&700<a&&(mainDashboardFunnelHeight=a-(Math.floor(window.innerHeight/3)+116),dashboardFontSize=16);mainDashboardWidth=
0<window.pageWrapperWidth?.7*window.pageWrapperWidth:mainDashboardWidth},showDashboardReport=function(a){var c=getDateFilterValues(),b=c.beginFilterDate;$("#beginReportDate").text((new moment(b)).format(defaultDateFormat));b=c.endFilterDate;$("#endReportDate").text((new moment(b)).format(defaultDateFormat));var d={block:{highlight:!0,fill:{type:"gradient"}},chart:{curve:{enabled:!0,height:33},height:mainDashboardFunnelHeight,bottomWidth:.64,bottomPinch:2,width:4*mainDashboardFunnelHeight/3},tooltip:{enabled:!0},
label:{fontSize:dashboardFontSize+"px"},events:{click:{block:function(g){console.log(g.label.raw)}}}},e=function(g,k){for(var l=[],h=0;h<k.length;h++){var m=k[h],n=(new Number(m.collectorCount)).toLocaleString(),p=getColorCodeProfileFunnel(h+1);l.push([m.collectorKey,n,p])}(new D3Funnel(g)).draw(l,d)},f=function(){e("#profile_funnel",dashboardDataModel.profileFunnelData);showProfileTotalStatistics();showTouchpointItemReport();setTimeout(function(){showTouchpointHubReport()},3E3)};!1===dashboardDataModel||
!0===a?($("#primary_dashboard_loader").show(),$("#primary_dashboard").hide(),c.journeyMapId=currentJourneyMapId,LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/dashboard-primary",c,function(g){$("#primary_dashboard_loader").hide();$("#primary_dashboard").show();0===g.httpCode&&""===g.errorMessage?(dashboardDataModel=g.data,f()):LeoAdminApiUtil.logErrorPayload(g)})):f()};
function showTouchpointHubReport(){var a=getDateFilterValues();a.journeyMapId=currentJourneyMapId;var c=$("#observer_report_wrapper");c.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');a.touchpointType=-1;a.startIndex=0;a.numberResult=30;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-hub-report",a,function(b){if("object"===typeof b.data&&""===b.errorMessage){var d=mainDashboardWidth;d=$("\x3ccanvas/\x3e").width(d).height(620);showProfileEventBubbleChart("Touchpoint Hub Report",
c,d,b.data);$("#observer_report_table").jsGrid({editing:!1,paging:!1,width:"100%",height:"auto",data:b.data,fields:[{name:"name",title:"Touchpoint Hub",align:"center",type:"text"},{name:"profileCount",title:"Total Profile",type:"number",align:"center",width:60},{name:"eventCount",title:"Total Event",type:"number",align:"center",width:60}]})}else LeoAdminApiUtil.logErrorPayload(b)})}
function showTouchpointItemReport(){var a=getDateFilterValues();a.journeyMapId=currentJourneyMapId;var c=$("#touchpoint_report_wrapper");c.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');a.touchpointType=-1;a.startIndex=0;a.numberResult=30;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-report",a,function(b){if("object"===typeof b.data&&""===b.errorMessage){var d=mainDashboardWidth;d=$("\x3ccanvas/\x3e").width(d).height(720);showProfileEventBubbleChart("Touchpoint Item Report",
c,d,b.data,"touchpoint");b=b.data.map(function(e){var f=e.touchpoint.url.trim();0===f.indexOf("http")&&(f='\x3ca target\x3d"_blank" href\x3d"'+f+'" title\x3d"'+f+'"\x3e'+e.touchpoint.name+"\x3cbr\x3e"+textTruncate(f,55)+"\x3c/a\x3e",e.touchpoint.name=f);return e});$("#touchpoint_report_table").jsGrid({editing:!1,paging:!1,width:"100%",height:"auto",data:b,fields:[{name:"touchpoint.name",title:"Touchpoint Item",align:"center",type:"text"},{name:"profileCount",title:"Total Profile",type:"number",align:"center",
width:60},{name:"eventCount",title:"Total Event",type:"number",align:"center",width:60}]})}else LeoAdminApiUtil.logErrorPayload(b)})}
function showProfileTotalStatistics(){$("#profile_summary_stats_loader").show();$("#profile_summary_stats").hide();LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/profile-total-stats",{},function(a){$("#profile_summary_stats_loader").hide();$("#profile_summary_stats").show();if(0===a.httpCode&&""===a.errorMessage){a=a.data;$("#profile_total_stats").empty();$("#marketing_metrics_holder").empty();$("#sales_metrics_holder").empty();$("#cx_metrics_holder").empty();for(var c=0;c<a.length;c++){var b=
a[c],d=b.collectorKey,e=b.collectorCount.toLocaleString("en-US");b=b.flowType;0===b?$("#profile_total_stats").append('\x3cdiv class\x3d"stats_item" \x3e '+d+" : "+e+" \x3c/div\x3e"):1===b?$("#marketing_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+d+" : "+e+" \x3c/div\x3e"):2===b?$("#sales_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+d+" : "+e+" \x3c/div\x3e"):3===b&&$("#cx_metrics_holder").append('\x3cdiv class\x3d"stats_item" \x3e '+d+" : "+e+" \x3c/div\x3e")}}else LeoAdminApiUtil.logErrorPayload(a)})}
function reportJourneyOfAllProfiles(){$("#profile_journey_funnel").empty();var a=dashboardDataModel.journeyStatsData;reportJourneyOfAllProfiles("#profile_journey_funnel",a);if(0!==a.length){a={labels:journeyLabel5A,subLabels:["VISITOR PROFILE","CONTACT PROFILE"],colors:[["#D6EAF8","#85C1E9","#3498DB"],["#B7F0B7","#8CF08C","#5CF45C"]],values:a};var c=$(containerId).parent().width();(new FunnelGraph({container:containerId,gradientDirection:"horizontal",data:a,displayPercent:!0,direction:"horizontal",
width:c,height:350,subLabelValue:"percent"})).draw()}};