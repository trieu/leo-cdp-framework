// Version: v_0.9.0_2025-12-12-12-24-53
'use strict';const chartColorCodes=[];for(var i=0;100>i;i++){var colorCode=Math.floor(16777215*Math.random()).toString(16);chartColorCodes.push("#"+colorCode)}const MAX_TO_LINE_CHART=chartColorCodes.length,journeyLabel5A=["AWARENESS","ATTRACTION","ASK","ACTION","ADVOCACY"];function randomInteger(a,d){return Math.floor(Math.random()*(d-a+1))+a}
function getColorCodeProfileFunnel(a){var d="#7A9F8D #5D897C #40736D #24585C #225059 #1F4360 #1A2E55 #161C4A #15113E #17202A".split(" ");return 0<=a&&10>=a?d[a-1]:d[0]}
const renderFunnelChart=function(a,d,e,c){var f=[];d.forEach(function(k){var b=k.orderIndex;f.push([k.name,"[Stage "+b+"]",c(b)])});(new D3Funnel(a)).draw(f,e)},renderJourneyFlowChart=function(a,d,e,c,f,k){d={margin:{top:5,left:70,right:50,bottom:50},nodes:{dynamicSizeFontNode:{enabled:!0,minSize:12,maxSize:22},fontSize:15,draggableX:!0,draggableY:!0,colors:d3.scaleOrdinal(d3.schemeCategory20)},links:{formatValue:function(b,l,g){return""},unit:d},tooltip:{infoDiv:!0,labelSource:"Input:",labelTarget:"Output:"}};
sk.createSankey(a,d,{nodes:c,links:f});$(a+" g.sk-node text").each(function(){var b=$(this).text().trim(),l=k[b];if("object"===typeof l){var g=l.totalProfile.toLocaleString();b='\x3ctspan dy\x3d"1em" x\x3d"-2" class\x3d"tphub_text_label"\x3e ['+l.journeyLevel+"] "+(b+" [Profile: "+g+" ]\x3c/tspan\x3e");$(this).html(b)}else console.error("touchpointHubMap[name] is NULL for name: "+b)});d3.selectAll("path.sk-link").style("stroke-width","1px")},renderSegmentSize=function(a,d,e,c,f,k,b){k=Math.floor(.97*
k);k=d3.arc().outerRadius(k).innerRadius(110);var l=d3.pie().sort(null).value(function(g){return g.count});a=d3.select(a).append("svg").attr("width",c).attr("height",f).append("g").attr("transform","translate("+c/2+","+f/2+")").selectAll(".arc").data(l(d)).enter().append("g");a.append("path").attr("d",k).style("fill",function(g,h){return g.data.color});e='\x3ctspan y\x3d"0" \x3e Segment Size: '+e.toLocaleString()+"\x3c/tspan\x3e";b='\x3ctspan y\x3d"24" \x3e'+b+"% of Total Profile \x3c/tspan\x3e";
a.append("text").attr("text-anchor","middle").attr("font-size","1.1em").attr("y",20).html(e);a.append("text").attr("text-anchor","middle").attr("font-size","1.1em").attr("y",20).html(b)},loadMediaTouchpoints=function(){var a=venn.VennDiagram().width(500).height(400),d=d3.select("#venn_two").datum([{sets:["Email"],figure:27.92,label:"Email",size:27.92},{sets:["Direct Traffic"],figure:55.28,label:"Direct Traffic",size:55.28},{sets:["Search Engine"],figure:7.62,label:"Search Engine",size:7.62},{sets:["Email",
"Direct Traffic"],figure:3.03,label:"Email and Direct Traffic",size:3.03},{sets:["Email","Search Engine"],figure:1.66,label:"Email and Search Engine",size:1.66},{sets:["Direct Traffic","Search Engine"],figure:2.4,label:"Direct Traffic and Search Engine",size:2.4},{sets:["Email","Direct Traffic","Search Engine"],figure:1.08,label:"Email, Direct Traffic, and Search Engine",size:1.08}]).call(a);d.selectAll("text").style("fill","white");d.selectAll(".venn-circle path").style("fill-opacity",.8).style("stroke-width",
1).style("stroke-opacity",1).style("stroke","fff");var e=d3.select("body").append("div").attr("class","venntooltip");d.selectAll("g").on("mouseover",function(c,f){venn.sortAreas(d,c);e.transition().duration(40).style("opacity",1);e.text(c.size+"% media touchpoint "+c.label);d3.select(this).transition("tooltip").duration(400).select("path").style("stroke-width",3).style("fill-opacity",1==c.sets.length?.8:0).style("stroke-opacity",1)}).on("mousemove",function(){e.style("left",d3.event.pageX+"px").style("top",
d3.event.pageY-28+"px")}).on("mouseout",function(c,f){e.transition().duration(2500).style("opacity",0);d3.select(this).transition("tooltip").duration(400).select("path").style("stroke-width",3).style("fill-opacity",1==c.sets.length?.8:0).style("stroke-opacity",1)})},personalityDiagram=function(){d3.select("chart_persornality").append("svg").attr("width",300).attr("height",300);RadarChart.draw("#chart_persornality",[[{area:"Openness",value:80},{area:"Conscientiousness",value:40},{area:"Extraversion",
value:40},{area:"Agreeableness",value:90},{area:"Neuroticism",value:60}]],{w:300,h:300,maxValue:100,levels:5,ExtraWidthX:300})},loadProfileAttribution=function(){$("#profile_attribution").width();var a=d3.select("#profile_attribution").append("svg").attr("width",800).attr("height",550).append("g").attr("transform","translate(140,30)"),d=d3.scaleBand().range([0,600]).domain(["Live_in_Saigon","Visited_Web","Installed_App","Used_Credit_Card","Buy_Product"]).padding(.01);a.append("g").attr("transform",
"translate(0,420)").attr("class","x_axis").call(d3.axisBottom(d)).selectAll("text").attr("transform","translate(-10,10)rotate(-30)").style("text-anchor","end").style("font-size",15).style("fill","#E91E0D");var e=d3.scaleBand().range([420,0]).domain(["Buy_Product","Used_Credit_Card","Installed_App","Visited_Web","Live_in_Saigon"]).padding(.01);a.append("g").attr("class","y_axis").call(d3.axisLeft(e)).selectAll("text").style("text-anchor","end").style("font-size",15).style("fill","#463CC4");var c=d3.scaleLinear().range(["white",
"#008748"]).domain([1,100]),f="/public/uploaded-files/sample-profile-attribution.csv?_\x3d"+(new Date).getTime();d3.csv(f,function(k){a.selectAll().data(k,function(b){return b.profile_attr+":"+b.persona_attr}).enter().append("rect").attr("id",function(b){return"cell_"+b.profile_attr+"_"+b.persona_attr}).attr("x",function(b){return d(b.profile_attr)}).attr("y",function(b){return e(b.persona_attr)}).attr("width",d.bandwidth()).attr("height",e.bandwidth()).style("fill",function(b){return c(b.matching_score)}).on("click",
function(b){var l=" [Profile attribute: "+b.profile_attr+" - Persona attribute: "+b.persona_attr+"] : Matching Score \x3d "+b.matching_score+" %";$("#attribution_description").text(l);a.select("#cell_"+b.profile_attr+"_"+b.persona_attr);l=" [Profile attribute: "+b.profile_attr+" - Persona attribute: "+b.persona_attr+"] : Matching Score \x3d "+b.matching_score+" %";$("#attribution_description").text(l).effect("highlight",{color:"#5eeb34"},6E3)}).on("mouseover",function(b){console.log(b);a.select("#cell_"+
b.profile_attr+"_"+b.persona_attr).style("fill","#5eeb34");b=" [Profile attribute: "+b.profile_attr+" - Persona attribute: "+b.persona_attr+"] : Matching Score \x3d "+b.matching_score+" %";$("#attribution_description").text(b)}).on("mouseout",function(b){a.select("#cell_"+b.profile_attr+"_"+b.persona_attr).style("fill",c(b.matching_score))})})};
function loadCustomerVenn(){var a=venn.VennDiagram().width($("#customer_source").width()).height(360),d=d3.select("#customer_source").datum([{sets:["Email"],figure:27.92,label:"Email",size:27.92},{sets:["Social Media"],figure:55.28,label:"Social Media",size:55.28},{sets:["Search Engine"],figure:7.62,label:"Search Engine",size:7.62},{sets:["Email","Social Media"],figure:3.03,label:"",size:3.03},{sets:["Email","Search Engine"],figure:2.66,label:"",size:1.66},{sets:["Social Media","Search Engine"],figure:2.4,
label:"",size:2.4},{sets:["Email","Social Media","Search Engine"],figure:1.08,label:"",size:1.08}]).call(a);d.selectAll("text").style("fill","white");d.selectAll(".venn-circle path").style("fill-opacity",.8).style("stroke-width",1).style("stroke-opacity",1).style("stroke","fff");var e=d3.select("body").append("div").attr("class","venntooltip");d.selectAll("g").on("mouseover",function(c,f){venn.sortAreas(d,c);e.transition().duration(40).style("opacity",1);e.text(c.size+"% of Segment Two saw "+c.label);
d3.select(this).transition("tooltip").duration(400).select("path").style("stroke-width",3).style("fill-opacity",1==c.sets.length?.8:0).style("stroke-opacity",1)}).on("mousemove",function(){e.style("left",d3.event.pageX+"px").style("top",d3.event.pageY-28+"px")}).on("mouseout",function(c,f){e.transition().duration(2500).style("opacity",0);d3.select(this).transition("tooltip").duration(400).select("path").style("stroke-width",3).style("fill-opacity",1==c.sets.length?.8:0).style("stroke-opacity",1)})}
function loadChannelPerformance(){var a=[{channelName:"Ecommerce Website",lead:181},{channelName:"Ecommerce App",lead:189},{channelName:"Social Media Groups",lead:387},{channelName:"Retail Store",lead:187},{channelName:"Book Reseller",lead:52}],d=$("#chart").width()-180-20,e=d3.scaleBand().range([300,0]).padding(.1),c=d3.scaleLinear().range([0,d]);d=d3.select("#chart svg").attr("width",d+180+20).attr("height",350).append("g").attr("transform","translate(180,20)");a.forEach(function(f){f.lead=+f.lead});
c.domain([0,d3.max(a,function(f){return f.lead})]);e.domain(a.map(function(f){return f.channelName}));d.selectAll(".bar").data(a).enter().append("rect").attr("class","bar").attr("width",function(f){return c(f.lead)}).attr("y",function(f){return e(f.channelName)}).attr("height",e.bandwidth());d.append("g").attr("transform","translate(0,300)").call(d3.axisBottom(c));d.append("g").call(d3.axisLeft(e))}
var renderTimeseriesChart=function(a,d,e,c,f){var k={labels:[],datasets:[]},b=[],l=getRawDateFilterValues(),g=l.beginFilterDate;for(l=l.endFilterDate;g.isBefore(l,"day");)b.push(g.format("YYYY-MM-DD")),g.add(1,"days");k.labels=b;var h=0;b=Object.keys(d.reportMap);$("#"+a).show().parent().find("#noti_"+a).remove();0===b.length&&(g='\x3cdiv id\x3d"noti_'+a+'" class\x3d"list-group-item" \x3e No data available \x3c/div\x3e',$("#"+a).hide().parent().append(g));b.sort();b.forEach(function(m){var n={};d.reportMap[m].forEach(function(q){var r=
q.dateKey;q=q.dailyCount;n[r]=n[r]?n[r]:0;n[r]+=q});var p=[];k.labels.forEach(function(q){p.push(n[q]?n[q]:0)});var t=chartColorCodes[h];h+=1;var u=!0;h>=MAX_TO_LINE_CHART&&(h=0,u=!1);var v=0<=m.indexOf("view")||0<=m.indexOf("click")||!0===f?!1:!0;k.datasets.push({label:m,backgroundColor:t,borderColor:t,fill:!1,borderWidth:1.6,tension:.3,showLine:u,hidden:v,data:p})});if(!0===e&&"object"===typeof c)c.data=k,c.update();else{e=(e=$("#"+a).data("chart-type"))?e:"line";a=document.getElementById(a);if(null==
a)return!1;a=a.getContext("2d");return new Chart(a,{type:e,data:k,options:{tooltips:{mode:"index",intersect:!0},responsive:!0,interaction:{pointHoverRadius:20,intersect:!0,mode:"index"},scales:{xAxes:{stacked:!1},yAxes:{stacked:!1}}}})}};
const PluginCenterTextChartJS=function(){return{beforeDraw:function(a,d,e){var c=a.data.donutChartCenterData;if("object"===typeof c){d="number"===typeof c.value?c.value:0;e="number"===typeof c.marginTop?c.marginTop:30;c="string"===typeof c.suffix?c.suffix:"";var f=a.width,k=a.height;a=a.ctx;a.restore();var b=(k/114).toFixed(2);a.font=b+"em sans-serif";a.textBaseline="middle";b=d;f=Math.round((f-a.measureText(b).width)/2);"string"===typeof c&&(b+=c,f-=10);0<=d?a.fillStyle="#1EC900":(a.fillStyle="#E80015",
f+=4);a.fillText(b,f,k/2+e);a.save()}}}},renderDonutChartJs=function(a,d,e){d=document.getElementById(d).getContext("2d");return new Chart(d,{type:"doughnut",data:e,options:{title:{display:!1,text:a,fontSize:15},responsive:!0,maintainAspectRatio:!0,showDatapoints:!0,legend:{display:!0},plugins:{datalabels:{color:"black",formatter:function(c){return c+"%"},font:{weight:"bold",size:15}}}},plugins:[PluginCenterTextChartJS(),ChartDataLabels]})},renderStackedBarChart=function(a,d){a=document.getElementById(a).getContext("2d");
return new Chart(a,{type:"bar",data:d,options:{tooltips:{mode:"index",intersect:!1},responsive:!0,interaction:{mode:"index"},scales:{xAxes:{stacked:!0},yAxes:{stacked:!0}}}})},showProfileEventBubbleChart=function(a,d,e,c,f){var k=0,b=0;0<c.length?(k=c[0].profileCount+90,b=c[0].eventCount+90):b=k=10;b=1E4<b?Math.ceil(b/1E3):10;var l=[];c.forEach(function(g,h){var m=f?g[f]:g,n=g.profileCount;g=g.eventCount;var p=n/k*50;p=28<p?28:p;p=7>p?7:p;m=textTruncate(null==m.name||""==m.name?"Unknown":m.name,70);
l.push({label:m,backgroundColor:chartColorCodes[h],borderColor:"#107CC5",data:[{x:g,y:n,r:p}]})});a={type:"bubble",data:{datasets:l},options:{plugins:{legend:{display:!0,position:"bottom",labels:{font:{size:12},padding:12}},title:{text:a,display:!0,font:{size:18},color:"#0000CD"},tooltip:{callbacks:{label:function(g){let h=g.dataset.label||"";h&&(h+=" | ");null!==g.parsed.y&&(h+="Profile: "+g.parsed.y);null!==g.parsed.x&&(h+=" | Event: "+g.parsed.x);return h}}}},responsive:!1,aspectRatio:1,showDatapoints:!1,
scales:{y:{title:{text:"Profile",display:!0,font:{size:16},color:"#0000CD",align:"end"},beginAtZero:!0,max:k,ticks:{stepSize:10,callback:function(g,h,m){return g}}},x:{title:{text:"Event",display:!0,font:{size:16},color:"#0000CD",align:"end"},beginAtZero:!0,ticks:{stepSize:b,callback:function(g,h,m){return g}}}}}};d.empty().append(e);d=e[0].getContext("2d");new Chart(d,a)},renderHorizontalBarChart=function(a,d,e){var c=22*e.length+10;d={data:{labels:d,datasets:[{axis:"y",data:e,fill:!1,backgroundColor:chartColorCodes,
borderColor:["rgb(0, 0, 0)"],borderWidth:1}]},type:"bar",options:{indexAxis:"y",plugins:{legend:{display:!1}},maxBarThickness:22,responsive:!0,maintainAspectRatio:!0,scales:{x:{title:{text:"Event",display:!0,font:{size:16},color:"#0000CD",align:"end"},beginAtZero:!0,ticks:{stepSize:5}}}}};e=$("\x3ccanvas/\x3e");a=$("#"+a);a.find("canvas").remove();a.html(e);e.height(c).css("height",c+"px");return new Chart(e[0],d)},renderVerticalBarChart=function(a,d,e){a=$("#"+a);a.find("canvas").remove();const c=
Math.max(8,Math.min(18,600/e.length));var f=Math.min(c*e.length+40,400);d={type:"bar",data:{labels:d,datasets:[{axis:"x",data:e,fill:!1,backgroundColor:chartColorCodes,borderColor:["rgba(0, 0, 0, 0.1)"],borderWidth:1,barThickness:c}]},options:{indexAxis:"x",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"nearest",intersect:!1}},scales:{x:{title:{text:"Event",display:!0,font:{size:14},color:"#0033cc"},ticks:{autoSkip:!1,maxRotation:45,minRotation:0}},y:{beginAtZero:!0,
ticks:{stepSize:Math.ceil(Math.max(...e)/5)||1}}}}};e=$("\x3cdiv/\x3e").css({"max-height":"400px","overflow-y":20<e.length?"auto":"hidden",padding:"10px"});f=$("\x3ccanvas/\x3e").css({height:f+"px",width:"100%"});e.append(f);a.html(e);return new Chart(f[0],d)},initPanZoomController=function(a,d,e,c){e.panzoom({zoomFactor:.02,zoomDelay:45,minZoom:a,maxZoom:d,fitPadding:100,panSpeed:2,panDistance:4,panDragAreaSize:75,panMinPercentSpeed:.25,panInactiveArea:8,panIndicatorMinOpacity:.5,zoomOnly:!1,fitSelector:c,
animateOnFit:function(){return!0},fitAnimationDuration:1E3,sliderHandleIcon:"fa fa-minus",zoomInIcon:"fa fa-plus",zoomOutIcon:"fa fa-minus",resetIcon:"fa fa-expand"})},renderDirectedGraph=function(a,d,e){const c=d.nodes.length;var f="#"+e,k={directed:!0,fit:!0,roots:f,padding:16};if(1<c){k.name="avsdf";var b=10<c?c:10;5>c?b*=20:10>c?b*=14:20>c?b*=10:25>c?b*=8:50>c?b*=6:75>c?b*=4:100>c&&(b*=2);k.nodeSeparation=b}a=document.getElementById(a);e=cytoscape.stylesheet().selector("node").style({color:"#000000",
"background-color":"#93C4F9","background-fit":"cover",height:32,width:32}).selector("node[weight \x3e\x3d 5]").style({"background-color":"#EF5B16",shape:"rectangle"}).selector("#"+e).style({"background-color":"#9EFA06","background-image":"https://cdn-icons-png.flaticon.com/128/1927/1927746.png",height:50,width:50}).selector("edge").style({label:"data(weight)","background-color":"#61bffc","curve-style":"bezier","target-arrow-shape":"triangle",width:3,"line-color":"#61bffc","target-arrow-color":"#61bffc"}).selector("edge[weight \x3e\x3d 5]").style({"line-color":"#F99633",
"target-arrow-color":"#F99633",width:5});var l=cytoscape({container:a,boxSelectionEnabled:!0,autounselectify:!0,wheelSensitivity:.1,style:e,elements:d,minZoom:.3,maxZoom:100,layout:k});l.zoomingEnabled(!0);l.userZoomingEnabled(!0);l.nodeHtmlLabel([{query:"node",halign:"center",valign:"bottom",halignBox:"center",valignBox:"bottom",cssClass:"",tpl(g){return"\x3cb\x3e "+g.id.toUpperCase()+"\x3c/b\x3e"}}]);initPanZoomController(.3,100,l,f);l.ready(function(){setTimeout(function(){var g=10;3>=c?g=250:
9>=c?g=180:15>=c?g=100:21>=c&&(g=50);l.fit(g)},680)});return l},renderMatrixChart=function(a,d,e,c,f){d=$("#"+d);const k=e.length,b=c.length;let l=19;24<=k?l=15:18<=k&&(l=17);if(0===k||0===b)d.html('\x3cdiv class\x3d"list-group-item"\x3eNo data available\x3c/div\x3e').removeClass("event_matrix_active");else{d.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');var g=Math.max(300,35*b+120);g=$("\x3ccanvas/\x3e").attr("height",g).css("height",g+"px");d.find("canvas").remove();d.html(g).addClass("event_matrix_active");
return new Chart(g[0],{type:"matrix",data:{datasets:[{label:"",data:f,backgroundColor(h){h=h.dataset.data[h.dataIndex];h="object"===typeof h?h.v:0;h=(0<h&&10>h?10:h)/180;return chroma("#313866").alpha(h).toString()},borderColor:"rgb(0, 0, 0)",borderWidth:0,width:({chart:h})=>(h.chartArea||{}).width/k-1,height:({chart:h})=>((h.chartArea||{}).height+80)/b-1,datalabels:{formatter(h,m){h=m.chart.data.datasets[0].data[m.dataIndex].v;return"number"===typeof h?h.toLocaleString():h},color:"#FF533F",font:{weight:"bold",
size:l}}}]},options:{maintainAspectRatio:!1,plugins:{legend:!1,title:{text:a,display:!0,font:{size:20},color:"#3300ff"},tooltip:{callbacks:{title:()=>"",label(h){h=h.dataset.data[h.dataIndex];return[`[${h.y}: ${h.v}] - ${h.x}`]}}}},scales:{x:{type:"category",labels:e,ticks:{display:!0,font:{size:13.5}},grid:{display:!1}},y:{type:"category",labels:c,offset:!0,ticks:{display:!0,font:{size:12.5}},grid:{display:!1}}}},plugins:[ChartDataLabels]})}};