// Version: v_0.9.0_2025-12-12-12-24-53
'use strict';const getOperators=function(){var a=_.union(getOperatorsForStringField(),getOperatorsForNumberField());a.push({type:"after",nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"before",nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"exactly_after",nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"exactly_before",nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"compare_month_and_day",nb_inputs:1,multiple:!0,apply_to:["date"]});a.push({type:"compare_month_and_day_between",
nb_inputs:2,multiple:!0,apply_to:["date"]});a.push({type:"compare_month_and_day_with_now",nb_inputs:0,multiple:!0,apply_to:["date"]});a.push({type:"compare_year_month_day_with_now",nb_inputs:0,multiple:!0,apply_to:["date"]});a.push({type:"is_today",nb_inputs:0,multiple:!0,apply_to:["date"]});a.push({type:"is_valid_date",nb_inputs:0,multiple:!0,apply_to:["date"]});a.push({type:"is_not_valid_date",nb_inputs:0,multiple:!0,apply_to:["date"]});a.push({type:"contains_any",optgroup:"List Operator",nb_inputs:1,
multiple:!0,apply_to:["string","number","boolean"]});a.push({type:"not_contains_any",optgroup:"List Operator",nb_inputs:1,multiple:!0,apply_to:["string","number","boolean"]});a.push({type:"event_in_journey",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["number"]});a.push({type:"has_key",optgroup:"Key Operator",nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"not_has_key",optgroup:"Key Operator",nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"sub_field_contains",optgroup:"Sub Field",
nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"sub_field_equals",optgroup:"Sub Field",nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"data_equals",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string","number","boolean"]});a.push({type:"data_less_than",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string","number"]});a.push({type:"data_equals_or_less_than",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string","number"]});a.push({type:"data_greater_than",
optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string","number"]});a.push({type:"data_equals_or_greater_than",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string","number"]});a.push({type:"data_contains",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"data_from",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string"]});a.push({type:"in_journey_map",optgroup:"Data Filter",nb_inputs:1,multiple:!0,apply_to:["string"]});return a},getTouchpointHubHosts=
function(a){var h={};for(const [g,d]of Object.entries(a))if(0===g.indexOf("http"))try{var e=(new URL(g)).host.replace("www.","");h[e]=d}catch(f){console.error(g),console.error(f)}return h},afterUpdateQueryBuilder=function(a,h){a=h.operator.type;a="compare_month_and_day_with_now"===a||"compare_year_month_day_with_now"===a;if("datepicker"===h.filter.plugin){h=h.$el.find(".rule-value-container input");var e=moment.utc().local().format("YYYY-MM-DD"),g=h.val();a&&""===g&&h.val(e);console.log("afterUpdateQueryBuilder "+
h.val());h.datepicker("update")}},buildSegmentDateFilter=function(a,h,e){return{id:a,label:h,type:"date",placeholder:"yyyy-mm-dd",validation:{format:"yyyy-mm-dd",allow_empty_value:!1},valueSetter:function(g,d){console.log("buildSegmentDateFilter.valueSetter ",d);d="string"===typeof d?[d]:d;d="object"===typeof d?d:[];0<d.length&&(d[0]=moment.utc(d[0]).local().format("YYYY-MM-DD"),d[1]=moment.utc(d[1]).local().format("YYYY-MM-DD"),g.$el.find(".rule-value-container input").each(function(f){var c=$(this);
c.val([d[f]]).css("width","100px");c.datepicker("update")}))},valueGetter:function(g){var d=[];g=g.$el.find(".rule-value-container input").each(function(){var f=$(this).css("width","100px").val().trim();""!==f&&d.push(moment(f).utc().local().format("YYYY-MM-DD").valueOf())});console.log("buildSegmentDateFilter.valueGetter ",d);g.attr("autocomplete","off").focus(function(){var f=$(this).offset().top+$(this).height()+8;$("div.datepicker-dropdown").css("top",f)});return 1===d.length?d[0]:d},plugin:"datepicker",
plugin_config:{format:"yyyy-mm-dd",todayBtn:"linked",todayHighlight:!0,autoclose:!0,orientation:"bottom"},operators:getOperatorsForDateField(),optgroup:e}},buildEventStatisticsFilter=function(a,h,e,g,d){return{id:a,label:h,type:"string",input:function(f,c){let b="";b+='\x3cselect class\x3d"form-control journey_map_selection" name\x3d"'+f.id+'_journey"\x3e';g.forEach(function(l){b+='\x3coption value\x3d"'+l.id+'" \x3e'+l.name+"\x3c/option\x3e"});b+='\x3c/select\x3e \x3ci class\x3d"fa fa-arrow-right" aria-hidden\x3d"true"\x3e\x3c/i\x3e ';
b+='\x3cselect class\x3d"form-control event_metric_selection" name\x3d"'+f.id+'_metric"\x3e';_.forEach(d,function(l,m){b+='\x3coption value\x3d"'+m+'"\x3e'+l+"\x3c/option\x3e"});b+="\x3c/select\x3e ";const k="equal not_equal less less_or_equal greater greater_or_equal".split(" ");b+='\x3cselect class\x3d"form-control event_metric_operator" name\x3d"'+f.id+'_operator"\x3e';for(let l of k)b+='\x3coption value\x3d"'+l+'"\x3e'+l+"\x3c/option\x3e";b+="\x3c/select\x3e ";return b+='\x3cinput placeholder\x3d"Value" class\x3d"form-control event_metric_value" type\x3d"number" name\x3d"'+
c+'" value\x3d"0"\x3e'},valueGetter:function(f){const c=f.$el.find(".rule-value-container"),b=c.find('select[name\x3d"'+f.id+'_journey"]').val(),k=c.find('select[name\x3d"'+f.id+'_metric"]').val(),l=c.find('select[name\x3d"'+f.id+'_operator"]').val();f=c.find('input[name\x3d"'+f.id+'_value_0"]').val();f=""!==f?parseInt(f,10):"0";return b+"#"+k+"#"+l+"#"+f},valueSetter:function(f,c){const b=f.$el.find(".rule-value-container");c&&(c=c.split("#"),c[0]&&b.find('select[name\x3d"'+f.id+'_journey"]').val(c[0]),
c[1]&&b.find('select[name\x3d"'+f.id+'_metric"]').val(c[1]),c[2]&&b.find('select[name\x3d"'+f.id+'_operator"]').val(c[2]),0<c[3].length&&b.find('input[name\x3d"'+f.id+'_value_0"]').val(c[3]))},operators:["event_in_journey"],optgroup:e}},buildSegmentProductFilter=function(a,h,e){return{id:a,label:h,type:"string",validation:{allow_empty_value:!1},valueSetter:function(g,d){1==g.operator.nb_inputs&&(d=[d]);g.$el.find(".rule-value-container input").each(function(f){$(this).val(d).css("width","220px")})},
valueGetter:function(g){var d="";g.$el.find(".rule-value-container input").each(function(){d=$(this).val()});return d},input:function(g,d){g='\x3ci class\x3d"fa fa-fw fa-search"\x3e\x3c/i\x3e\x3cinput placeholder\x3d"Item ID" class\x3d"form-control product_search" type\x3d"text" name\x3d"'+d+'"\x3e';setTimeout(function(){$('input.product_search[name\x3d"'+d+'"]').focus(function(){console.log("TODO open dialog search product by keywords, then return product ID")})},1E3);return g},operators:["contains_any",
"not_contains_any"],optgroup:e}},buildTouchpointFilter=function(a,h,e){return{id:a,label:h,type:"string",validation:{allow_empty_value:!1},valueSetter:function(g,d){1==g.operator.nb_inputs&&(d=[d]);g.$el.find(".rule-value-container input").each(function(f){$(this).val(d).css("width","220px")})},valueGetter:function(g){var d="";g.$el.find(".rule-value-container input").each(function(){d=$(this).val()});return d},input:function(g,d){g='\x3ci class\x3d"fa fa-fw fa-search"\x3e\x3c/i\x3e\x3cinput placeholder\x3d"Touchpoint ID" class\x3d"form-control touchpoint_search" type\x3d"text" name\x3d"'+
d+'"\x3e';setTimeout(function(){$('input.touchpoint_search[name\x3d"'+d+'"]').focus(function(){console.log("TODO open dialog search touchpoint by keywords, then return touchpoint ID")})},1E3);return g},operators:["contains_any","not_contains_any"],optgroup:e}},buildCustomDateTimeFilter=function(a,h,e,g){return{id:a,label:h,type:"string",validation:{allow_empty_value:!1},valueSetter:function(d,f){d.$el.find(".rule-value-container input").val(f[0]);d.$el.find(".rule-value-container select").val(f[1])},
valueGetter:function(d){var f=d.$el.find(".rule-value-container input").val();d=d.$el.find(".rule-value-container select").val();console.log(f,d);return[f,d]},input:function(d,f){d='\x3ci class\x3d"fa fa-fw fa-calendar"\x3e\x3c/i\x3e\x3cinput placeholder\x3d"Enter a number" class\x3d"form-control" type\x3d"number" name\x3d"'+f+'"\x3e\x3cselect class\x3d"form-control" name\x3d"select_time_unit_'+(f+'" \x3e');d=!0===g?d+'\x3coption value\x3d"months"\x3eMonth\x3c/option\x3e\x3coption value\x3d"days"\x3eDay\x3c/option\x3e':
d+'\x3coption value\x3d"years"\x3eYear\x3c/option\x3e\x3coption value\x3d"months"\x3eMonth\x3c/option\x3e\x3coption value\x3d"exactly_days"\x3eDay\x3c/option\x3e';return d+"\x3c/select\x3e"},operators:g?["after","before"]:["exactly_after","exactly_before"],optgroup:e}},buildSegmentJourneyFilter=function(a,h,e,g){return{id:a,label:h,type:"string",valueSetter:function(d,f){d.$el.find(".rule-value-container select").each(function(c){$(this).val(f[c]).trigger("change")})},valueGetter:function(d){var f=
[];d.$el.find(".rule-value-container select").each(function(){f.push($(this).val())});return f},input:function(d,f){var c='\x3cselect class\x3d"form-control segmentation_journey_map" \x3e';g.forEach(function(b){c+='\x3coption value\x3d"'+b.id+'" \x3e'+b.name+"\x3c/option\x3e"});c+='\x3c/select\x3e \x3ci class\x3d"fa fa-arrow-right" aria-hidden\x3d"true"\x3e\x3c/i\x3e ';c+='\x3cselect class\x3d"form-control" \x3e \x3coption value\x3d"0"\x3e IN ANY EVENT \x3c/option\x3e \x3coption value\x3d"1"\x3e AWARENESS \x3c/option\x3e \x3coption value\x3d"2"\x3e ATTRACTION \x3c/option\x3e \x3coption value\x3d"3"\x3e ASK \x3c/option\x3e ';
return c+=' \x3coption value\x3d"4"\x3e ACTION \x3c/option\x3e \x3coption value\x3d"5"\x3e ADVOCACY \x3c/option\x3e \x3c/select\x3e'},operators:["in_journey_map"],optgroup:e}},buildSegmentNumberSlider=function(a,h,e,g,d,f,c){return{id:a,label:h,type:"integer",validation:{min:e,max:g,step:d},operators:getOperatorsForNumberField(),plugin:"slider",plugin_config:{min:e,max:g,value:f,tooltip:"always"},valueSetter:function(b,k){1==b.operator.nb_inputs&&(k=[k]);b.$el.find(".rule-value-container input").each(function(l){$(this).slider("setValue",
k[l]||0)})},valueGetter:function(b){var k=[];b.$el.find(".rule-value-container input").each(function(){k.push($(this).slider("getValue"))});return 1==b.operator.nb_inputs?k[0]:k},optgroup:c}},segmentFiltersForCX=[buildSegmentNumberSlider("totalCFS","Total CFS",0,100,1,0,"CFS - Customer Feedback Score"),buildSegmentNumberSlider("positiveCFS","Positive CFS",0,100,1,0,"CFS - Customer Feedback Score"),buildSegmentNumberSlider("neutralCFS","Neutral CFS",0,100,1,0,"CFS - Customer Feedback Score"),buildSegmentNumberSlider("negativeCFS",
"Negative CFS",0,100,1,0,"CFS - Customer Feedback Score"),buildSegmentNumberSlider("totalCES","Total CES",0,100,1,0,"CES - Customer Effort Score"),buildSegmentNumberSlider("positiveCES","Positive CES",0,100,1,0,"CES - Customer Effort Score"),buildSegmentNumberSlider("neutralCES","Neutral CES",0,100,1,0,"CES - Customer Effort Score"),buildSegmentNumberSlider("negativeCES","Negative CES",0,100,1,0,"CES - Customer Effort Score"),buildSegmentNumberSlider("totalCSAT","Total CSAT",0,100,1,0,"CSAT - Customer Satisfaction Score"),
buildSegmentNumberSlider("positiveCSAT","Positive CSAT",0,100,1,0,"CSAT - Customer Satisfaction Score"),buildSegmentNumberSlider("neutralCSAT","Neutral CSAT",0,100,1,0,"CSAT - Customer Satisfaction Score"),buildSegmentNumberSlider("negativeCSAT","Negative CSAT",0,100,1,0,"CSAT - Customer Satisfaction Score"),buildSegmentNumberSlider("totalNPS","Total NPS",0,100,1,0,"NPS - Net Promoter Score"),buildSegmentNumberSlider("positiveNPS","Positive NPS",0,100,1,0,"NPS - Net Promoter Score"),buildSegmentNumberSlider("neutralNPS",
"Neutral NPS",0,100,1,0,"NPS - Net Promoter Score"),buildSegmentNumberSlider("negativeNPS","Negative NPS",0,100,1,0,"NPS - Net Promoter Score")],segmentFiltersForCustomerValue=[{id:"totalTransactionValue",label:"Total Transaction Value",type:"double",validation:{min:0,step:.01},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalLoyaltyScore",label:"Total Loyalty Score",type:"integer",validation:{step:1,min:0},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},
{id:"totalCreditScore",label:"Customer Credit Score",type:"integer",validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"rfeScore",label:"RFE Score",type:"integer",validation:{min:0,step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"rfmScore",label:"RFM Score",type:"integer",validation:{min:0,step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"churnScore",label:"Churn Score",type:"double",validation:{min:-100,
max:100,step:.01},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"}],advancedSegmentFilters=[{id:"receiveWebPush",label:"Receive Web Notification",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"],optgroup:"Data Privacy Consent/Agreement"},{id:"receiveAppPush",label:"Receive App Notification",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"],optgroup:"Data Privacy Consent/Agreement"},
{id:"receiveEmail",label:"Receive Email Marketing",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"],optgroup:"Data Privacy Consent/Agreement"},{id:"receiveSMS",label:"Receive Mobile SMS",type:"integer",input:"radio",values:{0:"No data",1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"],optgroup:"Data Privacy Consent/Agreement"},{id:"receiveAds",label:"Receive Retargeting Ads",type:"integer",input:"radio",values:{0:"No data",
1:"Subscribed","-1":"Unsubscribed"},operators:["equal","not_equal"],optgroup:"Data Privacy Consent/Agreement"},{id:"personalProblems",label:"Personal Problems",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"},{id:"personalInterests",label:"Personal Interests",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"},{id:"solutionsForCustomer",label:"Solutions For Customer",type:"string",operators:["contains_any","not_contains_any"],
optgroup:"Marketing Information"},{id:"nextBestActions",label:"Next Best Actions",type:"string",operators:["contains_any","not_contains_any"],input:"select",values:{"read-contents":"READ CONTENTS","buy-some-items":"BUY SOME ITEMS","subscribe-a-service":"SUBSCRIBE A SERVICE","checkout-items-in-cart":"CHECKOUT ITEMS IN CART","checkin-location":"CHECKIN LOCATION","play-a-game":"PLAY A GAME","take-a-course":"TAKE A COURSE","watch-a-video":"WATCH A VIDEO","take-a-trip":"TAKE A TRIP","read-a-book":"READ A BOOK"},
optgroup:"Marketing Information"},{id:"mediaChannels",label:"Reachable Media Channel",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"},{id:"contentKeywords",label:"Content Keywords",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"},{id:"productKeywords",label:"Product Keywords",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Marketing Information"}],getSegmentCustomQueryFilter=function(){return"object"===
typeof segmentCustomQueryEditor?segmentCustomQueryEditor.getValue().trim():""},handleSegmentCustomQueryFilter=function(a){"object"===typeof segmentDataModel&&initSegmentCustomQueryFilter(segmentDataModel.customQueryFilter||"",a)},initSegmentCustomQueryFilter=function(a,h){var e=window.segmentCustomQueryEditor;!1===e&&(e=$("#segment_custom_aql_editor").val(a)[0],e=CodeMirror.fromTextArea(e,{mode:"aql"}),"string"===typeof a&&e.setValue(a));var g=$("#segment_custom_query_holder");h&&""===a?g.hide():
(a=g.width(),e.setSize(100<a?a:800,230),e.replaceRange(" ",{line:e.lineCount()}),e.focus(),e.setCursor(e.lineCount(),0),e.setOption("readOnly",h));window.segmentCustomQueryEditor=e},loadSegmentBuilder=function(a,h,e,g,d){var f=function(c,b,k,l){var m=[{id:"status",label:"Custom Query Filter",type:"integer",input:"radio",values:{1:"Enabled"},operators:["equal"],optgroup:"Basic Profile Information"},{id:"dataContext",label:"Data Context",type:"integer",input:"radio",values:{1:"Production ",0:"QC Test ",
"-1":"Fake Data "},operators:["equal","not_equal"],optgroup:"Basic Profile Information"},{id:"type",label:"Profile Type",type:"integer",input:"select",values:{0:"ANONYMOUS_VISITOR",1:"LOGIN_USER_CONTACT",2:"CUSTOMER_CONTACT",3:"STUDENT_CONTACT",4:"CRM_IMPORTED_CONTACT",5:"DIRECT_INPUT_CONTACT",6:"INFLUENCER_CONTACT",7:"CLIENT_CONTACT",8:"B2B_PARTNER_CONTACT",9:"EMPLOYEE_CONTACT",10:"KEY_ACCOUNT_CONTACT",11:"SYSTEM_USER_CONTACT"},operators:["equal","not_equal"],optgroup:"Basic Profile Information"},
{id:"funnelStage",label:"Data Funnel Stage",type:"string",input:"select",values:{"new-visitor":"New Visitor","returning-visitor":"Returning Visitor",lead:"Lead",prospect:"Prospect","new-customer":"New Customer","engaged-customer":"Engaged Customer","happy-customer":"Happy Customer","customer-advocate":"Customer Advocate","unhappy-customer":"Unhappy Customer","terminated-customer":"Terminated Customer"},operators:["equal","not_equal"],optgroup:"Basic Profile Information"},buildSegmentJourneyFilter("cdp_profile__inJourneyMaps",
"Data Journey Map","Basic Profile Information",l),buildSegmentNumberSlider("dataQualityScore","Data Quality Score",0,maxTotalDataQualityScore,1,0,"Basic Profile Information"),{id:"dataLabels",label:"Data Labels",type:"string",operators:["contains","not_contains","contains_any","not_contains_any"],optgroup:"Basic Profile Information"},buildSegmentDateFilter("createdAt","Created Date","Basic Profile Information"),buildCustomDateTimeFilter("createdAt#1","Created in Time Range","Basic Profile Information"),
buildSegmentDateFilter("updatedAt","Updated Date by CDP","Basic Profile Information"),buildSegmentDateFilter("updatedByCrmAt","Updated Date by CRM","Basic Profile Information"),{id:"_key",label:"Profile ID",type:"string",operators:["equal","not_equal"],optgroup:"Profile Key Information"},{id:"visitorId",label:"Web Visitor ID",type:"string",operators:"equal not_equal is_empty is_not_empty is_null is_not_null".split(" "),optgroup:"Profile Key Information"},{id:"fingerprintId",label:"Fingerprint ID",
type:"string",operators:"equal not_equal is_empty is_not_empty is_null is_not_null".split(" "),optgroup:"Profile Key Information"},{id:"crmRefId",label:"Imported CRM ID",type:"string",operators:getOperatorsForStringField(),optgroup:"Profile Key Information"},{id:"primaryEmail",label:"Primary Email",type:"string",operators:getOperatorsForStringField(),optgroup:"Profile Key Information"},{id:"primaryPhone",label:"Primary Phone",type:"string",operators:getOperatorsForStringField(),optgroup:"Profile Key Information"},
{id:"primaryUsername",label:"Primary Username",type:"string",operators:getOperatorsForStringField(),optgroup:"Profile Key Information"},{id:"governmentIssuedIDs",label:"Citizen/Passport IDs",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Profile Key Information"},{id:"applicationIDs",label:"Application IDs",type:"string",operators:["contains_any","not_contains_any"],optgroup:"Profile Key Information"},buildCustomDateTimeFilter("dateOfBirth#1","Birthday Event","Personal Event",
!0),{id:"firstName",label:"First Name",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},{id:"lastName",label:"Last Name",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},{id:"primaryNationality",label:"Primary Nationality",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},{id:"permanentLocation",label:"Permanent Location Address",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},
{id:"livingLocation",label:"Living Location Address",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},{id:"livingCity",label:"Living City",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},{id:"livingState",label:"Living State",type:"string",operators:getOperatorsForStringField(),optgroup:"Personal Information"},buildSegmentNumberSlider("age","Age",0,150,1,0,"Personal Information"),buildSegmentDateFilter("dateOfBirth","Date of Birth",
"Personal Information"),{id:"gender",label:"Gender",type:"integer",input:"radio",values:{0:"Female",1:"Male",7:"Unknown"},operators:["equal","not_equal"],optgroup:"Personal Information"},buildSegmentNumberSlider("genderProbability","Gender Probability",0,100,1,0,"Personal Information"),{id:"totalLeadScore",label:"Total Lead Score",type:"integer",validation:{min:0,max:100,step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalProspectScore",label:"Total Prospect Score",
type:"integer",validation:{step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalEngagementScore",label:"Customer Engagement Score",type:"integer",validation:{min:0,step:1},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalCAC",label:"Customer Acquisition Cost",type:"double",validation:{min:0,step:.01},operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},{id:"totalCLV",label:"Customer Lifetime Value",type:"double",validation:{step:.01},
operators:getOperatorsForNumberField(),optgroup:"Scoring Model"},buildEventStatisticsFilter("eventStatistics","Event Statistics","Scoring Model",l,b),{id:"touchpoint__name",field:"cdp_touchpoint__name",label:"Engaged Touchpoint Names",type:"string",operators:["data_equals","data_contains"],optgroup:"Data Sources"},{id:"engagedTouchpointIds",field:"cdp_trackingevent__srcTouchpointUrl",label:"Source Touchpoint URL",type:"string",input:"select",values:c,operators:["data_from","data_contains"],optgroup:"Data Sources"},
{id:"referrerChannels",label:"Web Referrer Channel",type:"string",input:"select",values:getTouchpointHubHosts(c),operators:["has_key","not_has_key"],optgroup:"Data Sources"},{id:"lastTouchpoint__name",label:"Last Touchpoint Name",type:"string",operators:["sub_field_contains","sub_field_equals"],optgroup:"Data Sources"},{id:"lastTouchpoint__url",label:"Last Touchpoint URL",type:"string",operators:["sub_field_contains","sub_field_equals"],optgroup:"Data Sources"},{id:"lastSeenIp",label:"Last Seen IP Address",
type:"string",operators:["equal"],optgroup:"Data Sources"},{id:"saleAgencies",label:"Sales Agency / Sales Source",type:"string",operators:["contains","not_contains","contains_any","not_contains_any"],optgroup:"Sale Sources"},{id:"saleAgents",label:"Sales Agent / Sales Person",type:"string",operators:["contains","not_contains","contains_any","not_contains_any"],optgroup:"Sale Sources"},{id:"softSkills",label:"Soft Skills",type:"string",operators:["contains","not_contains","contains_any","not_contains_any"],
optgroup:"Education"},{id:"learningHistory",label:"Learning History",type:"string",operators:["contains","not_contains","contains_any","not_contains_any"],optgroup:"Education"},{id:"studyCertificates",label:"Study Certificates",type:"string",operators:["contains","not_contains","contains_any","not_contains_any"],optgroup:"Education"},{id:"jobTitles",label:"Job Title",type:"string",operators:["contains","not_contains","contains_any","not_contains_any"],optgroup:"Working Experience"},{id:"workingHistory",
label:"Working History",type:"string",operators:["contains","not_contains","contains_any","not_contains_any"],optgroup:"Working Experience"},{id:"businessIndustries",label:"Business Industry",type:"string",operators:["contains","not_contains","contains_any","not_contains_any"],optgroup:"Working Experience"},{id:"behavioralEvents",label:"Behavioral Event Metrics",type:"string",input:"select",values:b,operators:["contains_any","not_contains_any"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__metricName",
label:"Event Metric Name",type:"string",operators:getOperatorsForStringEqualityField(),optgroup:"Behavioural Event"},{id:"cdp_trackingevent__metricValue",label:"Event Metric Value",type:"integer",operators:getOperatorsForNumberField(),optgroup:"Behavioural Event"},{id:"cdp_trackingevent__timeSpent",label:"Time Spent in seconds",type:"integer",operators:getOperatorsForNumberField(),optgroup:"Behavioural Event"},{id:"cdp_trackingevent__fingerprintId",label:"Web Fingerprint ID",type:"string",operators:["data_equals",
"data_contains"],optgroup:"Behavioural Event"},buildSegmentDateFilter("cdp_trackingevent__createdAt","Event Creation Date","Behavioural Event"),buildCustomDateTimeFilter("cdp_trackingevent__createdAt#1","Event Time Range","Behavioural Event"),buildSegmentDateFilter("cdp_trackingevent__updatedAt","Event Modification Date","Behavioural Event"),{id:"cdp_trackingevent__srcTouchpointName",label:"Source from Touchpoint Name",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},
{id:"cdp_trackingevent__srcTouchpointUrl",label:"Source from Touchpoint URL",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__refTouchpointName",label:"Referrer from Touchpoint Name",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__refTouchpointUrl",label:"Referrer from Touchpoint URL",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__locationName",
label:"Event from Location Name",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__locationCode",label:"Event from Location Code",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__sourceIP",label:"Event from Source IP",type:"string",operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__refCampaignId",label:"Event from Campaign ID",type:"string",
operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__environment",label:"Data Environment",type:"string",input:"select",values:{pro:"In Production",qctest:"In QC Test",dev:"In Development"},operators:["data_equals","data_contains"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__fraudScore",label:"Fraud Score",type:"integer",operators:["data_equals"],optgroup:"Behavioural Event"},{id:"cdp_trackingevent__transactionId",label:"Transaction ID",type:"string",
operators:["data_equals","data_contains"],optgroup:"Transaction Event"},buildSegmentDateFilter("cdp_trackingevent__createdAt#2","Transaction Date","Transaction Event"),{id:"cdp_trackingevent__transactionValue",label:"Transaction Value",type:"double",validation:{step:.01},operators:getOperatorsForNumberField(),optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionStatus",label:"Transaction Status",type:"string",operators:["data_equals","data_contains"],optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionCode",
label:"Transaction Code",type:"integer",operators:getOperatorsForNumberField(),optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionDiscount",label:"Transaction Discount",type:"double",validation:{step:.01},operators:getOperatorsForNumberField(),optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionCurrency",label:"Transaction Currency",type:"string",operators:["data_equals","data_contains"],optgroup:"Transaction Event"},{id:"cdp_trackingevent__transactionPayment",label:"Transaction Payment",
type:"string",operators:["data_equals","data_contains"],optgroup:"Transaction Event"},{id:"cdp_trackingevent__deviceType",label:"Device Type",type:"string",operators:getOperatorsForStringEqualityField(),input:"radio",values:{General_Desktop:"Desktop PC",General_Mobile:"Mobile",General_Tablet:"Tablet"},optgroup:"Device Information"},{id:"cdp_trackingevent__deviceId",label:"Device ID",type:"string",operators:["data_equals","data_contains"],optgroup:"Device Information"},{id:"cdp_trackingevent__deviceName",
label:"Device Name",type:"string",operators:["data_equals","data_contains"],optgroup:"Device Information"},{id:"cdp_trackingevent__deviceOS",label:"Device OS",type:"string",operators:["data_equals","data_contains"],optgroup:"Device Information"},{id:"lastUsedDeviceId",label:"Last Used Device ID",type:"string",operators:["equal"],optgroup:"Device Information"},buildSegmentProductFilter("shoppingItemsIds","Shopping Item ID","Product Information"),buildSegmentProductFilter("purchasedItemIds","Purchased Item ID",
"Product Information"),{id:"productKeywords#1",label:"Purchased Item Category",type:"string",input:"select",values:window.PRODUCT_ITEM_CATEGORIES||{},operators:["contains_any","not_contains_any"],optgroup:"Product Information"}];k.forEach(function(n){m.push({id:"assetGroup_"+n.id,field:"behavioralEvents",label:"Events in Asset Group: "+n.title,type:"string",input:"select",values:n.eventNamesForSegmentation,operators:["contains_any","not_contains_any"],optgroup:"Behavioral Events in Asset Group"})});
m=m.concat(advancedSegmentFilters);m=m.concat(segmentFiltersForCustomerValue);return m=m.concat(segmentFiltersForCX)};LeoAdminApiUtil.getSecuredData("/cdp/journeymap/list",{},function(c){if(0===c.httpCode&&""===c.errorMessage){c=c.data;var b=g||!1,k=$("#segment-builder-holder");k.on("afterCreateRuleFilters.queryBuilder",function(l,m){console.log("QueryBuilder afterUpdateRuleFilter",l,m);var n='select[name\x3d"'+m.id+'_filter"]';setTimeout(function(){$(n).select2()},300)}).on("afterUpdateRuleValue.queryBuilder",
afterUpdateQueryBuilder);k.queryBuilder({plugins:["bt-tooltip-errors"],operators:getOperators(),filters:f(a,h,e,c),rules:b});"function"===typeof d&&d()}else LeoAdminApiUtil.logErrorPayload(c)})},deleteSegment=function(){if("object"===typeof segmentDataModel&&""!=window.segmentDataModel.id){$("#delete_callback").val("");$("#confirmDeleteParentChildDialog").modal({focus:!0});$("#deleteChildItemMsg").text("Delete all profiles and related data in this segment ! (Be Careful)");$("#deleteChildItemCheckbox").prop("checked",
!1);$("#deleteChildItem").show();var a="deleteSegment"+segmentDataModel.id;window[a]=function(){var h=baseLeoAdminUrl+"/cdp/segment/delete",e=$("#deleteChildItemCheckbox").is(":checked");iziToast.info({title:"Data Deletion",message:'Start the job to delete the segment "'+segmentDataModel.name+'"'});LeoAdminApiUtil.callPostAdminApi(h,{segmentId:segmentDataModel.id,deleteAllProfiles:e},function(g){if(0===g.httpCode){var d=g.data;0<=d?($("#deleteChildItem").hide(),$("#deleteChildItemMsg").text(""),iziToast.success({title:"OK",
message:'Successfully deleted the segment "'+segmentDataModel.name+'". Total deleted profile: '+d,onClosing:function(f,c,b){location.hash="calljs-leoCdpRouter('Segment_Management')"}})):iziToast.error({title:"Error",message:g.data,onClosing:function(f,c,b){location.reload(!0)}})}else $("#error-on-save").html(g.errorMessage).show().delay(5E3).fadeOut("slow"),LeoAdminApiUtil.logErrorPayload(g)})};$("#delete_parent_callback").val(a);$("#deletedParentInfoTitle").html(segmentDataModel.name);$("#deletedParentInfoMsg").html("Do you want to delete the segment ?")}},
loadProfileViewForSegmentParams=function(a){var h=$("#segment-builder-holder"),e=h.queryBuilder("getRules");a.jsonQueryRules="object"===typeof e?JSON.stringify(e):"";a.customQueryFilter=getSegmentCustomQueryFilter();a.realtimeQuery=!0===h.data("realtime-query");a.withLastEvents=!0===h.data("with-last-events");a.segmentId=segmentDataModel.id;console.log("loadProfileViewForSegmentParams",e);return JSON.stringify(a)},loadProfilesInSegment=function(a,h){var e=$("#profile_list_querybuilder");if("object"===
typeof segmentDataModel)if(!0===a){if(segmentDataModel.realtimeQuery=!0,a=e.DataTable())a.clear(),setTimeout(a.ajax.reload,888)}else{var g=$("#segment_profile_list_loader");g.show();setTimeout(function(){loadProfileViewForSegment(e,"/cdp/segment/profile-query-builder");$("#profile-list-panel").show();g.hide()},"number"===typeof h?h:900)}},loadProfileViewForSegment=function(a,h){var e="function"===typeof initPersonalizationInSegment&&0<window.defaultPersonalizationService.length,g=[{render:function(c,
b,k){b="Web Visitor";try{var l=k.firstName||"",m=k.lastName||"";if(0<l.length||0<m.length)b=textTruncate(l+" "+m,32)}catch(n){console.log(n)}return'\x3cdiv style\x3d"font-size:13.5px;"\x3e\x3ca target\x3d"_blank" title\x3d"Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+(c+"')\" \x3e")+b+"\x3c/a\x3e\x3c/div\x3e"},targets:0,orderable:!1},{render:function(c,b,k){c=profileContactTypes[c].replace("_CONTACT","");return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:10.8px;"\x3e\x3ca target\x3d"_blank" title\x3d"Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+
(k.id+"')\" \x3e"+c+"\x3c/a\x3e\x3c/div\x3e")},targets:1,orderable:!1},{render:function(c,b,k){b="-";0===c?b='\x3ci class\x3d"fa fa-female"\x3e\x3c/i\x3e Female':1===c?b='\x3ci class\x3d"fa fa-male"\x3e\x3c/i\x3e Male':2<=c&&6>=c&&(b="LGBT");return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:10.8px;" \x3e'+b+"\x3c/div\x3e"},targets:2,orderable:!1},{render:function(c,b,k){return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:11px;" \x3e\x3ca title\x3d"Profile Email" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+
(k.id+"')\" \x3e"+textTruncate("string"===typeof c?c:"-",24)+"\x3c/a\x3e\x3c/div\x3e")},targets:3,orderable:!1},{render:function(c,b,k){return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:11px;" \x3e\x3ca title\x3d"Profile Phone" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+(k.id+"')\" \x3e"+textTruncate("string"===typeof c?c:"-",20)+"\x3c/a\x3e\x3c/div\x3e")},targets:4,orderable:!1},{render:function(c,b,k){c=k.lastTouchpoint?k.lastTouchpoint.name:"";return'\x3cdiv class\x3d"datatable_text" style\x3d"font-size:11px;" title\x3d"'+
c+'" \x3e'+textTruncate(c,45)+"\x3c/div\x3e"},targets:5,orderable:!1},{render:function(c,b,k){return'\x3cdiv class\x3d"datatable_text text-center"\x3e'+c+"\x3c/div\x3e"},targets:6,orderable:!1},{render:function(c,b,k){return'\x3cdiv class\x3d"datatable_text text-center"\x3e'+c+"\x3c/div\x3e"},targets:7,orderable:!1},{render:function(c,b,k){return'\x3cdiv class\x3d"datatable_text text-center"\x3e'+c+"\x3c/div\x3e"},targets:8,orderable:!1},{render:function(c,b,k){return c?'\x3cdiv class\x3d"small"\x3e'+
toLocalDateTime(c)+"\x3c/div\x3e":""},targets:9,orderable:!1}],d=getUserSession();if("string"===typeof d){var f=a.DataTable({lengthMenu:[[20,30,50],[20,30,50]],processing:!0,serverSide:!0,searching:!1,serverMethod:"POST",ajax:{url:h,contentType:"application/json",beforeSend:function(c){$("#btn-run-querybuilder, #btn-reset-querybuilder").attr("disabled","disabled");c.setRequestHeader("leouss",d)},data:loadProfileViewForSegmentParams},columnDefs:g,columns:[{data:"id"},{data:"type"},{data:"gender"},
{data:"primaryEmail"},{data:"primaryPhone"},{data:"lastTouchpoint"},{data:"dataQualityScore"},{data:"totalLeadScore"},{data:"totalCLV"},{data:"updatedAt"}]});f.on("draw",function(){$("#btn-run-querybuilder, #btn-reset-querybuilder").removeAttr("disabled");var c=f.rows().count();console.log("loadProfileViewForSegment is displayed in table, count: "+c);e&&0<c&&(c=f.row(0).data(),initPersonalizationInSegment(c.id))})}},loadSegmentListByFilter=function(a,h,e,g,d){var f=[{data:"id"},{data:"name"},{data:"totalCount"},
{data:"description"},{data:"ownerUsername"},{data:"createdAt"},{data:"updatedAt"}],c=getUserSession();if(c)return $(e).DataTable({lengthMenu:[[20,30,40],[20,30,40]],processing:!0,serverSide:!0,searching:!0,search:{return:!0},ordering:!0,serverMethod:"POST",ajax:{url:baseLeoAdminUrl+"/cdp/segments/filter",contentType:"application/json",beforeSend:function(b){$(h).show();$(a).hide();b.setRequestHeader("leouss",c)},data:function(b){var k=b.order[0];b.sortField=f[k.column].data;b.sortAsc="asc"===k.dir;
b.searchValue=b.search.value;delete b.order;delete b.search;"function"===typeof g&&(b=g(b));return JSON.stringify(b)},dataSrc:function(b){var k=b.canInsertData,l=b.canEditData,m=b.canDeleteData;$(e).data("canInsertData",k);$(e).data("canEditData",l);$(e).data("canDeleteData",m);"function"===typeof d&&d(b);$(h).hide();$(a).show();return b.data}},columnDefs:[{render:function(b,k,l){return'\x3ci class\x3d"fa fa-users" aria-hidden\x3d"true"\x3e\x3c/i\x3e'},targets:0,orderable:!1},{render:function(b,k,
l){k="#calljs-leoCdpRouter('Segment_Details','"+l.id+"')";l=textTruncate(b,50);return'\x3cdiv class\x3d"segment_name_in_list"\x3e \x3cmark\x3e \x3ca title\x3d"Segment Name: '+b+'" href\x3d"'+k+'" \x3e'+l+"\x3c/a\x3e \x3c/mark\x3e\x3c/div\x3e"},targets:1},{render:function(b,k,l){b=b.toLocaleString();return'\x3cdiv class\x3d"segment_size " style\x3d"min-width:95px; font-size:14.2px" title\x3d"The size of segment: '+b+'" \x3e\x3cmark\x3e'+b+"\x3c/mark\x3e\x3c/div\x3e"},targets:2},{render:function(b,
k,l){return'\x3cdiv  style\x3d"font-size:0.8em;" title\x3d"'+b+'" \x3e'+textTruncate(b,150)+"\x3c/div\x3e"},targets:3,orderable:!1},{render:function(b,k,l){return'\x3cdiv style\x3d"min-width:90px; text-align:center" \x3e'+b+"\x3c/div\x3e"},targets:4,orderable:!1},{render:function(b,k,l){return'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff;min-width:80px" \x3e'+toLocalDateTime(b)+"\x3c/div\x3e"},targets:5},{render:function(b,k,l){return b?'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff;min-width:80px" \x3e'+
toLocalDateTime(b)+"\x3c/div\x3e":"-"},targets:6},{render:function(b,k,l){b='\x3ca class\x3d"control" title\x3d"Segment Report" href\x3d"#calljs-leoCdpRouter(\'Segment_Details\',\''+(l.id+'\')" \x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e View\x3c/a\x3e');$(e).data("canEditData")&&(b+='\x3cbr\x3e \x3ca class\x3d"control" title\x3d"Segment Builder" href\x3d"#calljs-leoCdpRouter(\'Segment_Builder\',\''+(l.id+'\')" \x3e \x3ci class\x3d"fa fa-pencil-square-o" aria-hidden\x3d"true"\x3e\x3c/i\x3e Edit\x3c/a\x3e '));
return b},targets:7}],columns:f,order:[[6,"desc"]]})};
var segmentQueryBuilderCallback=function(){$("#btn-reset-querybuilder").on("click",function(){$("#segment-builder-holder").queryBuilder("reset")});$("#segment_builder_div").show();$("#segment_builder_loader").hide();loadSegmentStatistics(segmentDataStats);$("#btn-run-querybuilder").click(function(){var a=$(this),h=$("#segment-builder-holder").queryBuilder("getRules");if(!$.isEmptyObject(h)){$("#btn-run-querybuilder, #btn-reset-querybuilder").attr("disabled","disabled");$("#segment_profile_list").hide();
$("#segment_profile_list_loader").show();h=JSON.stringify(h);var e={};e.jsonQueryRules=h;e.customQueryFilter=getSegmentCustomQueryFilter();LeoAdminApiUtil.callPostAdminApi(baseLeoAdminUrl+"/cdp/segment/statistics",e,function(g){$("#segment_profile_list").show();$("#segment_profile_list_loader").hide();a.removeAttr("disabled");0===g.httpCode&&"object"===typeof g.data?(loadSegmentStatistics(g.data),loadProfilesInSegment(!0)):iziToast.error({title:"Error",message:g.data,onClosing:function(d,f,c){location.reload(!0)}})})}})},
getSegmentBuilderData=function(a){LeoAdminApiUtil.callPostAdminApi(baseLeoAdminUrl+"/cdp/segment/load",{id:a},function(h){if(0===h.httpCode&&""===h.errorMessage){segmentDataStats=h.data.segmentStats;var e=h.data.behavioralEventMap,g=h.data.assetGroups,d=h.data.touchpointHubs,f=h.data.segmentData,c=f.name,b=f.managedBySystem,k=JSON.parse(f.jsonQueryRules);document.title="Segment Builder: "+c;$("#segment_name").text("Segment: "+c);$("#sm_type input:checked").prop("checked",!1);$('#sm_type input[value\x3d"'+
f.type+'"]').prop("checked",!0);$('#sm_status input[value\x3d"'+f.status+'"]').prop("checked",!0);b?($("button.data-control-delete").attr("disabled","disabled"),$("button.data-control-delete").attr("title","Can not delete this segment, which is managed by system")):h.canDeleteData?$("button.data-control-delete").click(deleteSegment):$("button.data-control-delete").attr("disabled","disabled");setSegmentDataForm(f);handleSegmentCustomQueryFilter(!1);loadSegmentBuilder(d,e,g,k,segmentQueryBuilderCallback);
loadProfilesInSegment(!1,700);loadSystemUsersForDataAuthorization(h.canSetAuthorization,f,$("#authorizedSegmentViewers"),$("#authorizedSegmentEditors"))}else LeoAdminApiUtil.logErrorPayload(h)})},createNewSegmentModel=function(){LeoAdminApiUtil.callPostAdminApi(baseLeoAdminUrl+"/cdp/segment/load",{},function(a){if(0===a.httpCode&&""===a.errorMessage){var h=a.data.behavioralEventMap,e=a.data.segmentData,g=a.data.assetGroups,d=a.data.touchpointHubs;setSegmentDataForm(e);document.title="New Segment Builder";
$("#segment_name").text("New Segment Builder: ");loadSegmentBuilder(d,h,g,!1,segmentQueryBuilderCallback);loadProfilesInSegment(!1,700);loadSystemUsersForDataAuthorization(a.canSetAuthorization,e,$("#authorizedSegmentViewers"),$("#authorizedSegmentEditors"))}else LeoAdminApiUtil.logErrorPayload(a)})},setSegmentDataForm=function(a){segmentDataModel=a;$("#sm_name").val(a.name).keyup(function(){segmentDataModel.name=$(this).val().trim();$("#segment_name").text("Segment: "+segmentDataModel.name)});$("#sm_description").val(a.description).keyup(function(){segmentDataModel.description=
$(this).val().trim()});$("#sm_realtimeQuery").prop("checked",a.realtimeQuery).change(function(){segmentDataModel.realtimeQuery=$(this).prop("checked")});$("#sm_indexscore").val(a.indexScore).change(function(){segmentDataModel.indexScore=parseInt($(this).val())});$("#sm_forDeepAnalytics").prop("checked",a.forDeepAnalytics).change(function(){segmentDataModel.forDeepAnalytics=$(this).prop("checked")});$("#sm_forPredictiveAnalytics").prop("checked",a.forPredictiveAnalytics).change(function(){segmentDataModel.forPredictiveAnalytics=
$(this).prop("checked")});$("#sm_forPersonalization").prop("checked",a.forPersonalization).change(function(){segmentDataModel.forPersonalization=$(this).prop("checked")});$("#sm_forEmailMarketing").prop("checked",a.forEmailMarketing).change(function(){segmentDataModel.forEmailMarketing=$(this).prop("checked")});$("#sm_forRealtimeMarketing").prop("checked",a.forRealtimeMarketing).change(function(){segmentDataModel.forRealtimeMarketing=$(this).prop("checked")});$("#sm_forReTargeting").prop("checked",
a.forReTargeting).change(function(){segmentDataModel.forReTargeting=$(this).prop("checked")});$("#sm_forLookalikeTargeting").prop("checked",a.forLookalikeTargeting).change(function(){segmentDataModel.forLookalikeTargeting=$(this).prop("checked")});$("#sm_for3rdSynchronization").prop("checked",a.for3rdSynchronization).change(function(){segmentDataModel.for3rdSynchronization=$(this).prop("checked")})},saveSegmentMetaData=function(){var a=$("#sm_name").val().trim();if(""===a)notifyErrorMessage("Please enter the name of segment, it can not be empty !");
else if("object"===typeof segmentDataModel){segmentDataModel.name=a;a=$("#segment-builder-holder").queryBuilder("getRules");$.isEmptyObject(a)?segmentDataModel.jsonQueryRules="":segmentDataModel.jsonQueryRules=JSON.stringify(a)||"";segmentDataModel.customQueryFilter=getSegmentCustomQueryFilter();segmentDataModel.type=parseInt($("#sm_type input:checked").val());segmentDataModel.status=parseInt($("#sm_status input:checked").val());segmentDataModel.realtimeQuery=$("#sm_realtimeQuery").prop("checked");
5<=currentUserProfile.role&&(segmentDataModel.authorizedViewers=$("#authorizedSegmentViewers").val()||[],segmentDataModel.authorizedEditors=$("#authorizedSegmentEditors").val()||[]);a=JSON.stringify(segmentDataModel);var h=baseLeoAdminUrl+"/cdp/segment/save";$("#segment_builder_div").hide();$("#segment_builder_loader").show();LeoAdminApiUtil.callPostAdminApi(h,{dataObject:a},function(e){0===e.httpCode?""===e.data?$("#error-on-save").html("Data is not valid !").show().delay(5E3).fadeOut("slow"):(location.hash=
"calljs-leoCdpRouter('Segment_Details','"+e.data+"')",notifySavedOK("Your segment has been created and saved")):(0<=e.errorMessage.indexOf("jsonQueryRules")&&(e.errorMessage="Please set filtering parameters in the segment query builder"),$("#error-on-save").html(e.errorMessage).show().delay(5E3).fadeOut("slow"),LeoAdminApiUtil.logErrorPayload(e))})}};