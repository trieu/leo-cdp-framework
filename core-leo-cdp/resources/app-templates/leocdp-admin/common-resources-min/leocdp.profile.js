'use strict';function profileAddNewTextHashSet(a){var c=$('\x3cli class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e\x3cdiv class\x3d"col-md-11" \x3e\x3cinput class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashset" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-md-1" \x3e\x3ch4 onclick\x3d"$(this).parent().parent().parent().remove()" \x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');
$('p[data-field\x3d"'+a+'"] \x3e ul').append(c);c.effect("highlight",{},3600);c.find("input:first").focus()}function profileAddNewCustomField(a){var c=$(loadCustomFieldEditor(a,"",""));$('p[data-field\x3d"'+a+'"] \x3e ul').append(c);c.effect("highlight",{},3600);c.find("input:first").focus()}
function handleProfileListFiltersBy(a,c){$("#profile_filter_inputs \x3e .form-control").val("").hide();$(c).show();$("#profile_filter_input_label").text($(a).text()).show();$("#main_search_profile").val("");showDeleteNotActiveProfile()}
var addNewHashMapItem=function(a,c){var b=a+"_"+(new Date).getTime(),d=$("#"+a),e=Object.assign({},c);d.find("option:selected").each(function(){var h=$(this).val();delete e[h]});a=$(loadHashMapSelector(b,a,e,"",""));d.find("ul.list-group").append(a);a.effect("highlight",{},4E3)};function removeHashMapItem(a){$(a).parent().parent().remove()}
function loadHashMapSelector(a,c,b,d,e){var h='\x3cdiv class\x3d"col-md-3" \x3e \x3cselect class\x3d"form-control" id\x3d"key_'+a+'" name\x3d"'+c+'" \x3e';_.forOwn(b,function(n,g){n='\x3coption name\x3d"'+c+'" value\x3d"'+g+'"\x3e '+g.toUpperCase()+" \x3c/option\x3e";g===d&&(n='\x3coption name\x3d"'+c+'" selected value\x3d"'+g+'"\x3e '+g.toUpperCase()+" \x3c/option\x3e");h+=n});h+=" \x3c/select\x3e \x3c/div\x3e";""===d&&$("#key_"+a).find("option:first").attr("selected","selected");return'\x3cli id\x3d"item_'+
a+'" class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e '+h+('\x3cdiv class\x3d"col-md-8" \x3e\x3cinput id\x3d"value_'+a+'" value\x3d"'+(e?e:"")+'" class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashmap" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv title\x3d"Delete" class\x3d"col-md-1" onclick\x3d"removeHashMapItem(this)" \x3e \x3ch4\x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e \x3c/div\x3e\x3c/li\x3e')}
function loadCustomFieldEditor(a,c,b){return'\x3cli class\x3d"list-group-item" \x3e\x3cdiv class\x3d"row" \x3e \x3cdiv class\x3d"col-md-3" \x3e \x3cinput type\x3d"text" class\x3d"form-control custom_field_name" placeholder\x3d"Field Name" value\x3d"'+(c+'"\x3e \x3c/div\x3e\x3cdiv class\x3d"col-md-8" \x3e\x3cinput class\x3d"form-control custom_field_value" type\x3d"text" value\x3d"')+((b?b:"")+'" placeholder\x3d"Field Value" data-fieldholder\x3d"hashmap" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv title\x3d"Delete" class\x3d"col-md-1" onclick\x3d"removeHashMapItem(this)" \x3e \x3ch4\x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e \x3c/div\x3e \x3c/div\x3e\x3c/li\x3e')}
const loadProfileDataIntoDOM=function(a,c,b,d,e,h,n){var g={};"string"===typeof c?(g.profileId=c,g.idType="profileId"):"string"===typeof b?(g.crmRefId=b,g.idType="crmRefId"):"string"===typeof d&&(g.visitorId=d,g.idType="visitorId");LeoAdminApiUtil.callPostAdminApi(baseLeoAdminUrl+"/cdp/profile/get",g,function(p){if(0===p.httpCode&&""===p.errorMessage){var f=p.canInsertData,k=p.canDeleteData;p.canEditData||$("button.data-control-edit").attr("disabled","disabled");k||$("button.data-control-delete").attr("disabled",
"disabled");f||$("button.data-control-insert").attr("disabled","disabled");LeoCdpAdmin.routerContext.dataObject="function"===typeof e?e(p.data):p.data;$("#data_model_holder").find("*[data-field]").each(function(){var l=$(this).attr("type"),q=$(this).data("fieldholder"),v=$(this).data("fieldtype"),w=$(this).data("field"),x=w.split(".");if(1===x.length){var m=LeoCdpAdmin.routerContext.dataObject[x[0]];if("html"===q){if("int"===v||"float"===v)if(void 0===m||null==m)m="-";else{if(m=(new Number(m)).toLocaleString(),
NaN==m||"NaN"==m)m="-"}else"date"===v?m=m?moment.utc(m).local().format("YYYY-MM-DD"):"-":"date_time"===v?m=m?toLocalDateTime(m):"-":"phone"===v&&(m=m?m.replace(/\D/g,""):"-");$(this).html(m)}else if("percentage"===q)$(this).html(m).parent().attr("aria-valuenow",m).css("width",m+"%"),l=$(this).parent(),l.attr("title",m+"% "+l.attr("title"));else if("url"===q)$(this).html(checkToAddUrlValueToDOM(m));else if("locationcode"===q)l=$("\x3ca/\x3e").attr("href","javascript:").html(textTruncate(m,80)).click(function(){var r=
LeoCdpAdmin.routerContext.dataObject.locationCode;0===r.indexOf("http")?eModal.iframe(r,"Location"):r&&""!=r.trim()&&eModal.iframe("https://plus.codes/"+r,m)}),$(this).html(l);else if("selectionvalue"===q)"checkbox"===l&&1==m?$(this).attr("checked","checked"):"radio"===l&&m==$(this).val()&&$(this).attr("checked","checked");else if("html_hashmap"===q){var t=' \x3cul class\x3d"list-group" \x3e ';_.forOwn(m,function(r,u){u=u.trim();a?(r=loadHashMapSelector(w+"_"+u,w,"socialMediaProfiles"===w?SocialMediaIconMap:
"personalContacts"===w?PersonalContactIconsMap:ContactIconsMap,u,r),t+=r):(u="socialMediaProfiles"===w?SocialMediaIconMap[u]?SocialMediaIconMap[u]:!1:"personalContacts"===w?PersonalContactIconsMap[u]?PersonalContactIconsMap[u]:!1:ContactIconsMap[u]?ContactIconsMap[u]:!1,!1===u&&(u=' \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e '),t=t+'\x3cli class\x3d"list-group-item" \x3e '+u+checkToAddUrlValueToDOM(r)+"\x3c/li\x3e")});t+=" \x3c/ul\x3e ";$(this).html(t)}else"html_hashset"===
q?(t='\x3cul class\x3d"list-group" \x3e',_.forOwn(m,function(r,u){r=a?'\x3cdiv class\x3d"col-md-11" \x3e\x3cinput value\x3d"'+r+'" class\x3d"form-control" type\x3d"text" placeholder\x3d"Value" data-fieldholder\x3d"hashset" data-fieldtype\x3d"string" autocomplete\x3d"off"\x3e\x3c/div\x3e\x3cdiv class\x3d"col-md-1" \x3e\x3ch4 onclick\x3d"$(this).parent().parent().parent().remove()" \x3e\x3ci class\x3d"fa fa-times-circle delete-item-btn" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/h4\x3e\x3c/div\x3e':"system_user"===
v?' \x3cdiv class\x3d"col-md-12" \x3e \x3cb\x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/b\x3e '+buildSystemUserInfoLink(r)+"\x3c/div\x3e":' \x3cdiv class\x3d"col-md-12" \x3e \x3cb\x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e\x3c/b\x3e '+checkToAddUrlValueToDOM(r)+"\x3c/div\x3e";t=t+'\x3cli class\x3d"list-group-item" \x3e \x3cdiv class\x3d"row" \x3e '+r+"\x3c/div\x3e\x3c/li\x3e"}),t+="\x3c/ul\x3e",$(this).html(t)):"html_list_key_value"===
q?(t='\x3cul class\x3d"list-group" \x3e',l=Object.keys(m),l.sort(),l.forEach(function(r){t=t+'\x3cli class\x3d"list-group-item" \x3e '+r+'  \x3ci class\x3d"fa fa-arrow-right" aria-hidden\x3d"true"\x3e\x3c/i\x3e  '+m[r]+"\x3c/li\x3e"}),t+="\x3c/ul\x3e",$(this).html(t)):"html_custom_field"===q?(t=' \x3cul class\x3d"list-group" \x3e ',_.forOwn(m,function(r,u){u=u.trim();a?(r=loadCustomFieldEditor(w+"_"+u,u,r),t+=r):(t+='\x3cli class\x3d"list-group-item" \x3e',t+='\x3cdiv class\x3d"row" \x3e \x3cdiv class\x3d"col-md-3"\x3e \x3cb\x3e '+
u+'\x3c/b\x3e \x3ci  style\x3d"font-size:20px" class\x3d"fa fa-equals" aria-hidden\x3d"true"\x3e\x3c/i\x3e \x3c/div\x3e',t+='\x3cdiv class\x3d"col-md-9"\x3e'+r+"\x3c/div\x3e \x3c/div\x3e\x3c/li\x3e")}),t+=" \x3c/ul\x3e ",$(this).html(t)):"inputvalue"===q&&$(this).val(m)}else if(2===x.length){var y=LeoCdpAdmin.routerContext.dataObject[x[0]]||{};m=y[x[1]]||"";"html"===q?$(this).html(m):"date"===v?(m=moment.utc(m).local().format("YYYY-MM-DD"),$(this).html(m)):"date_time"===v?(m=moment.utc(m).local().format("YYYY-MM-DD HH:mm:ss"),
$(this).html(m)):"inputvalue"===q?$(this).val(m):"url"===q?$(this).html(checkToAddUrlValueToDOM(m)):"eventlocation"===q&&(l=$("\x3ca/\x3e").attr("href","javascript:").html(m).click(function(){var r=y.locationCode||"";r&&""!=r.trim()&&eModal.iframe("https://plus.codes/"+r,m)}),$(this).html(l))}else 3===x.length&&(y=LeoCdpAdmin.routerContext.dataObject[x[0]]||{},m=(y[x[1]]||{})[x[2]]||"","html"===q?$(this).html(m):"inputvalue"===q?$(this).val(m):"url"===q?$(this).html(checkToAddUrlValueToDOM(m)):"eventlocation"===
q&&(l=$("\x3ca/\x3e").attr("href","javascript:").html(m).click(function(){var r=y.locationCode||"";r&&""!=r.trim()&&eModal.iframe("https://plus.codes/"+r,m)}),$(this).html(l)),"date"===v?(m=moment.utc(m).local().format("YYYY-MM-DD"),$(this).html(m)):"date_time"===v&&(m=moment.utc(m).local().format("YYYY-MM-DD HH:mm:ss"),$(this).html(m)))}).promise().done(function(){"function"===typeof h&&h()})}else LeoAdminApiUtil.logErrorPayload(p)},n)};
var updateProfileDataToModel=function(a,c,b){$("#data_model_holder").find("*[data-field]").each(function(){var d=$(this).data("field"),e=$(this).data("fieldholder"),h=$(this).data("fieldtype");e="checkbox"===$(this).attr("type")?$(this).prop("checked"):"html"===e?$(this).html().trim():$(this).val();"int"===h?e=parseInt(e.replace(/,/g,"")):"float"===h?e=parseFloat(e.replace(/,/g,"")):"date"===h?e=new Date(e):"tel"===h&&(e=e.replace(/\D/g,""));d=d.split(".");1===d.length?LeoCdpAdmin.routerContext.dataObject[d[0]]=
e:2===d.length&&(LeoCdpAdmin.routerContext.dataObject[d[0]][d[1]]=e)}).promise().done(function(){LeoAdminApiUtil.callPostAdminApi(a,c,function(d){0===d.httpCode&&""===d.errorMessage?"function"===typeof b&&b(d):LeoAdminApiUtil.logErrorPayload(d)})})},loadProfileEventDailyReportUnit=function(){var a=currentJourneyMapId||"",c=getDateFilterValues();c.profileId=viewProfileId;c.journeyMapId=a;a=c.beginFilterDate;$("#eventDataFromDate").text((new moment(a)).format("YYYY-MM-DD HH:mm:ss"));a=c.endFilterDate;
$("#eventDataToDate").text((new moment(a)).format("YYYY-MM-DD HH:mm:ss"));var b=$("#profile_event_report_loader").show();LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/event-report/profile",c,function(d){b.hide();0===d.httpCode&&""===d.errorMessage?!1!==window.profileTimeseriesChart?renderTimeseriesChart("timeseriesProfileEventChart",d.data,!0,profileTimeseriesChart,!0):window.profileTimeseriesChart=renderTimeseriesChart("timeseriesProfileEventChart",d.data,!1,!1,!0):LeoAdminApiUtil.logErrorPayload(d)})};
function handleProfileTabBehavioralInfo(){$("#event_flow_tabs a:first").click();$("#event_flow_vertital_tabs div:first").addClass("active")}function handleProfileTabExtInfo(){$("#profile_ext_info_tabs a:first").click();$("#profile_ext_info_vertital_tabs div:first").addClass("active")}
const loadRecommendedContentsOfProfile=function(a,c,b){var d=defaultRecommendedItemForProfile,e=$("#recommended_content_list").empty().html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData("/cdp/profile/recommended-contents",{profileId:a,startIndex:0,numberResult:d},function(h){h=h.data;var n=h.length;0<n?e.empty():e.empty().html('\x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e');_.forEach(h,function(g){var p=_.template($("#recommended-content-tpl").html());
g.indexScore=e.find("\x3e div").length+1;g.updatedAt=moment.utc(g.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");var f=g.content.headlineImageUrl;g.content.headlineImageUrl=null==f||""===f?"https://cdn-icons-png.flaticon.com/128/9872/9872434.png":f;g.content.landingPageUrl=null==g.content.fullUrl||""===g.content.fullUrl?g.content.shortLinkUrl:g.content.fullUrl;g=p(g);e.append(g)});!0===c&&new Sortable(e[0],{swap:!0,swapClass:"sortable_highlighted_item",animation:150,onEnd:function(g){var p=g.newIndex,
f=g.swapItem;g=$(g.item).data("key");f=$(f).data("key");var k=parseInt($("#rank_content_"+g).text());p+=1;$("#rank_content_"+g).text(p);$("#rank_content_"+f).text(k);var l={};$("#recommended_content_list span.rank_info").each(function(q){q=$(this).data("key");var v=parseInt($(this).text());l[q]=v;console.log(l)}).promise().done(function(){var q={rankingInfoList:JSON.stringify(l),graphName:"cdp_content_graph",profileId:a,recommendationModel:1};LeoAdminApiUtil.callPostAdminApi("/cdp/profile/update-item-ranking",
q,function(v){v.data?iziToast.success({title:"Update Content Content Ranking",timeout:3E3,message:"Data is saved successfully!"}):LeoAdminApiUtil.logErrorPayload(v)})})}});"function"===typeof b&&b(n)})};
var loadRecommendedProductsOfProfile=function(a,c,b){var d=defaultRecommendedItemForProfile,e=$("#recommended_product_list").empty().html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData("/cdp/profile/recommended-products",{profileId:a,startIndex:0,numberResult:d},function(h){h=h.data;var n=h.length;0<n?e.empty():e.empty().html('\x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e');var g=_.template($("#recommended-product-tpl").html());_.forEach(h,function(p){var f=
p.product;if("object"===typeof f){p.indexScore=e.find("\x3e div").length+1;p.updatedAt=moment.utc(p.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");f.offerPrice=f.salePrice*(1-p.discount);f.discount=100*p.discount;f.keywordsText=textTruncate(f.keywords.join(", "),6555);var k=f.headlineImageUrl;f.headlineImageUrl=null==k||""===k?NO_IMAGE_URL:k;p=g(p);e.append(p)}});!0===c&&new Sortable(e[0],{swap:!0,swapClass:"sortable_highlighted_item",animation:150,onEnd:function(p){var f=p.newIndex,k=p.swapItem;
p=$(p.item).data("key");k=$(k).data("key");var l=parseInt($("#rank_product_"+p).text());f+=1;$("#rank_product_"+p).text(f);$("#rank_product_"+k).text(l);var q={};e.find("span.rank_info").each(function(v){v=$(this).data("key");var w=parseInt($(this).text());q[v]=w;console.log(q)}).promise().done(function(){var v={rankingInfoList:JSON.stringify(q),graphName:"cdp_product_graph",profileId:a,recommendationModel:1};LeoAdminApiUtil.callPostAdminApi("/cdp/profile/update-item-ranking",v,function(w){w.data?
iziToast.success({title:"Product Item Ranking",timeout:2200,message:"Data is saved successfully!"}):LeoAdminApiUtil.logErrorPayload(w)})})}});$("input.autoselectall").on("click",function(){$(this).select()});"function"===typeof b&&b(n)})},loadPurchasedItemsOfProfile=function(){LeoAdminApiUtil.getSecuredData("/cdp/profile/get-purchased-items",{profileId:viewProfileId,startIndex:0,numberResult:100},function(a){var c=$("#purchased_items_list");a=a.data;0<a.length&&c.empty();_.forEach(a,function(b){var d=
_.template($("#purchased-product-tpl").html());b.indexScore=c.find("\x3e div").length+1;b.createdAt=moment.utc(b.createdAt).local().format("YYYY-MM-DD HH:mm:ss");b=d(b);c.append(b)})});return!1},loadFinancialEventList=function(){if(LeoCdpAdmin.routerContext.dataObject){var a=$("#financial_event_list"),c=LeoCdpAdmin.routerContext.dataObject.financeCreditEvents||[];0<c.length&&a.empty();_.forEach(c,function(b){var d=_.template($("#financial-event-tpl").html());"good"===b.risk?(b.riskIcon="fa-thumbs-o-up",
b.riskIconColor="#45D50F"):(b.riskIcon="fa-thumbs-o-down",b.riskIconColor="#F40209");b.risk=b.risk.toUpperCase();b=d(b);a.append(b)})}},emptyInfo='\x3cbr\x3e \x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e \x3cbr\x3e',loadEventsInProfileIndex=0,loadEventsInProfileResult=25,callApiToGetTrackingEventsOfProfile=function(a,c){var b=$("#profile_activitiy_flow"),d=$("#profile_activitiy_flow_container");0===loadEventsInProfileIndex&&(b.empty().css({"max-height":"660px","min-height":"80px"}),
d.css({height:"680px"}));if(0<b.find("li.all-loaded").length)console.log("Loaded all data for loadEventsInProfile"),b.show();else{d.hide();var e=$("#profile_activitiy_flow_loader").show(),h={profileId:viewProfileId};h.startIndex=loadEventsInProfileIndex;h.numberResult=loadEventsInProfileResult;h.journeyMapId=currentJourneyMapId;h.searchValue=a;LeoAdminApiUtil.getSecuredData("/cdp/profile/tracking-events",h,function(n){e.hide();0===n.data.length&&(0===loadEventsInProfileIndex?(b.html(emptyInfo),$("#profileEventStatistics").html(emptyInfo)):
(b.find("li:last-child").addClass("all-loaded"),$("#profile_activitiy_flow_done").show(),$("#btn_loadMoreEvents").attr("disabled","disabled").attr("title","All data is loaded"),$("#btn_filterEvents").attr("disabled","disabled")));_.forEach(n.data,function(g){try{null!=g.srcTouchpoint&&(g.srcTouchpoint.url=g.srcTouchpoint.url.replace("leosyn\x3d","leovid\x3d"),g.srcTouchpoint.name=textTruncate(decodeURISafe(g.srcTouchpoint.name),120),g.srcTouchpoint.truncatedUrl=textTruncate(g.srcTouchpoint.url,120));
g.createdAt=moment.utc(g.createdAt).local().format("YYYY-MM-DD HH:mm:ss");g.cssStyleDisplayTransactionData=0<g.transactionValue&&""!==g.transactionPayment&&""!==g.transactionStatus?"block":"none";g.cssStyleDisplayLocation=0<g.locationCode.length?"block":"none";0<_.size(g.eventData)?g.cssStyleDisplayEventData="block":g.cssStyleDisplayEventData="none";0<_.size(g.orderedItems)?g.cssStyleDisplayOrderedItems="block":g.cssStyleDisplayOrderedItems="none";0<_.size(g.serviceItems)?g.cssStyleDisplayServiceItems=
"block":g.cssStyleDisplayServiceItems="none";var p=g.journeyStage,f=_.template($("#"+(0<(g.transactionId||"").length?"conversion-event-tpl":3<=p?"action-event-tpl":2===p?"key-info-view-event-tpl":"view-event-tpl")).html())(g);b.append(f)}catch(k){console.error(k,g)}});d.show();"function"===typeof c?c():(n=b.height()+20,d.height(n).scrollTop(0),console.log("\x3d\x3d\x3e hfh \x3d "+n))})}},loadEventsInProfile=function(a,c,b){$("#btn_loadMoreEvents").removeAttr("disabled").attr("Load more events");$("#btn_filterEvents").removeAttr("disabled");
!0===a&&(loadEventsInProfileIndex=0,$("#profile_activitiy_flow_done").hide());a=$("#keywords_filter_events");!0===c&&a.val("");c=a.val().trim();callApiToGetTrackingEventsOfProfile(c,b)};
function initProfileEventInStream(){loadEventsInProfile(!0,!0);$("#keywords_filter_events").keypress(function(a){"13"==(a.keyCode?a.keyCode:a.which)&&(0<$(this).val().trim().length?(loadEventsInProfileIndex=0,loadEventsInProfile(!1,!1)):loadEventsInProfile(!0,!1))}).change(function(){$("#profile_activitiy_flow").empty();$("#profile_activitiy_flow_container").height(20).scrollTop(0);$("#btn_loadMoreEvents").attr("disabled","disabled")})}
function loadMoreEventsInProfile(){loadEventsInProfileIndex=$("#profile_activitiy_flow \x3e li").length;0!==loadEventsInProfileIndex&&loadEventsInProfile(!1,!1,function(){$(document).scrollTop($(document).height()-100);var a=$("#profile_activitiy_flow_container"),c=a.prop("scrollHeight")+200;a.scrollTop(c)})}var loadFeedbacksInProfileIndex=0,loadFeedbacksInProfileResult=120;
function loadFeedbackEventsInProfile(){$("#keyword_filter_feedbacks").val("");var a=$("#profile_feedback_flow");0===loadEventsInProfileIndex&&(a.empty(),$("#keywords_filter_events").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_activitiy_flow li").show()}));var c=$("#profile_feedback_flow_loader").show();LeoAdminApiUtil.getSecuredData("/cdp/profile/feedback-events",{id:viewProfileId,startIndex:loadFeedbacksInProfileIndex,numberResult:loadFeedbacksInProfileResult},function(b){c.hide();
b=b.data;0===b.length?a.html('\x3cli class\x3d"list-group-item view" \x3e \x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e \x3c/li\x3e'):(a.css("height","650px"),_.forEach(b,function(d,e){d.createdAt=moment.utc(d.createdAt).local().format("YYYY-MM-DD HH:mm:ss");e=baseLeoObserverUrl+"/webform?\x26tplfbt\x3dSURVEY\x26tplid\x3d"+d.refTemplateId;d.previewUrl="SURVEY"===d.feedbackType?e:d.touchpointUrl;e=d.eventName;d.eventIcon="submit-feedback-form"===e?"fa-commenting-o":"submit-rating-form"===
e?"fa-star":"fa-smile-o";e=$("RATING"===d.feedbackType?"#feedback-rating-event-tpl":"#feedback-survey-event-tpl").html();e=_.template(e);a.append(e(d))}))});$("#keyword_filter_feedbacks").change(function(){2>$(this).val().trim().toLowerCase().length&&$("#profile_feedback_flow li").show()})}
function filterFeedbackEvent(){var a=$("#keyword_filter_feedbacks").val().trim().toLowerCase(),c=$("#profile_feedback_flow li");2<=a.length&&c.each(function(){0>$(this).find("h5.media-heading").text().toLowerCase().indexOf(a)?$(this).hide():$(this).show()})}function removeCurrentProfile(){var a=LeoCdpAdmin.routerContext.dataObject;a?LeoCdpAdmin.navFunctions.removeCustomerProfile(a.id):notifyErrorMessage("LeoCdpAdmin.routerContext.dataObject is NULL !")}
function refreshCurrentProfile(){var a=LeoCdpAdmin.routerContext.dataObject;if(a){var c=(new Date).getTime();location.hash="#calljs-leoCdpRouter('Customer_Profile_Info','"+a.id+"','_refresh_"+c+"')"}else notifyErrorMessage("LeoCdpAdmin.routerContext.dataObject is NULL !")}var deduplicateCurrentProfileDialog=function(){$("#deduplicateCurrentProfileDialog").modal({backdrop:"static",keyboard:!1,focus:!0})};
function deduplicateCurrentProfile(){var a=LeoCdpAdmin.routerContext.dataObject;a&&($("#deduplicateCurrentProfileDialog").modal("hide"),iziToast.info({title:"Profile Data Duplication",message:"The system is processing for profile deduplication. It takes several minutes to do this job"}),LeoAdminApiUtil.callPostAdminApi("/cdp/profile/deduplicate",{profileId:a.id},function(c){0===c.httpCode&&""===c.errorMessage?("object"===typeof c.data&&iziToast.info({title:"Merge Duplicate Profile",message:"Total processed profile: "+
c.data.count}),c=(new Date).getTime(),location.hash="#calljs-leoCdpRouter('Profile_Management','_refresh_"+c+"')"):LeoAdminApiUtil.logErrorPayload(c)}))}
function removeSelectedProfiles(){$("#delete_callback").val("");$("#confirmDeleteDialog").modal({focus:!0});var a=Object.keys(window.selectedProfileIdMap||{}).length;0<a&&""===$("#filterProfileListByStatus").val()&&($("#deletedInfoTitle").text("Total Selected Profile \x3d "+a).show(),$("#deletedInfoMsg").text("Do you want to remove selected profiles?"),window.removeSelectedProfilesConfirmOk=function(){LeoAdminApiUtil.callPostAdminApi("/cdp/profiles/batch-update",selectedProfileIdMap,function(c){0===
c.httpCode&&""===c.errorMessage?(iziToast.info({title:"Customer Profile Management",message:"Total removed profile is "+c.data+" !"}),window.selectedProfileIdMap={},resetProfileSearch()):LeoAdminApiUtil.logErrorPayload(c)})},$("#delete_callback").val("removeSelectedProfilesConfirmOk"))}
function deleteNotActiveProfile(){$("#delete_callback").val("");$("#deletedInfoTitle").empty().hide();var a=$("#filterProfileListByStatus option:selected").text().trim();$("#deletedInfoMsg").text("Do you want to delete ALL "+a+" ?");$("#confirmDeleteDialog").modal({focus:!0});window.deleteNotActiveProfileConfirmOk=function(){var c=$("#filterProfileListByStatus").val(),b=-4;""!=c&&(b=parseInt(c));LeoAdminApiUtil.callPostAdminApi("/cdp/profiles/delete-not-active",{status:b},function(d){0===d.httpCode&&
""===d.errorMessage?(iziToast.info({title:"Profile Data Management",message:"Deleted \x3cb\x3e"+d.data+"\x3c/b\x3e profiles"}),resetProfileSearch()):LeoAdminApiUtil.logErrorPayload(d)})};$("#delete_callback").val("deleteNotActiveProfileConfirmOk")}
function loadProfileJourneyFlowReport(a,c){$("#journeyFlowChart").parent().hide();""===c&&(c="id_default_journey");LeoAdminApiUtil.getSecuredData("/cdp/analytics360/journey-flow-report",{journeyMapId:c,profileId:a},function(b){if(0<b.errorCode)iziToast.error({title:"Data Journey Map",message:b.errorMessage});else{var d=b.data;b=d.defaultMetricName;var e=d.journeyStages,h=d.journeyLinks,n=d.journeyNodes;d=d.touchpointHubMap;$("#journeyFlowChart").parent().show();renderJourneyFlowChart("#journeyFlowChart",
b,e,n,h,d)}})}
const renderProfileBarChart=function(a,c){if(c){var b=[],d=[];$.each(c,function(e,h){b.push(e);d.push(h)});renderVerticalBarChart(a,b,d)}else $("#"+a).html('\x3cdiv class\x3d"list-group-item" \x3e No data available \x3c/div\x3e')},loadProfileEventMatrix=function(a,c){var b={};b.profileId=a;b.journeyMapId=c;LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/event-matrix",b,function(d){0===d.httpCode&&""===d.errorMessage?(d=d.data,renderMatrixChart("Event Matrix Report","profile_event_matrix",
d.xLabels,d.yLabels,d.dataList)):LeoAdminApiUtil.logErrorPayload(d)})},refreshProfileDataJourneyMap=function(){loadProfileDataJourneyReport(viewProfileId,currentJourneyMapId)},loadJourneyReportForProfile=function(a){setTimeout(function(){renderProfileBarChart("profileReferrerChannels",a.referrerChannels)},3100);var c=currentJourneyMapId||"id_default_journey",b={};$.each(a.eventStatistics,function(e,h){var n=e.indexOf("-");if(0>n)b[c]="object"===typeof b[c]?b[c]:{},b[c][e]=h;else{var g=e.substring(0,
n).trim();e=e.substring(n+1);b[g]="object"===typeof b[g]?b[g]:{};b[g][e]=h;b[""]="object"===typeof b[""]?b[""]:{};b[""][e]="number"===typeof b[""][e]?b[""][e]+h:h}});a.journeyEventStats=b;var d=window.viewProfileId;loadJourneyMapList(!1,function(e,h){renderProfileBarChart("profileEventStatsChart",b[e]);loadProfileEventMatrix(d,e);loadProfileDataJourneyReport(d,e);loadEventsInProfile(!0,!0);setTimeout(function(){loadProfileEventDailyReportUnit()},1E3)},!0,function(e,h){renderProfileBarChart("profileEventStatsChart",
b[e]);setTimeout(function(){window.profileTimeseriesChart=!1;$("#timeseriesProfileEventChart").empty();loadProfileEventDailyReportUnit();loadProfileEventMatrix(d,e)},5E3)})},loadProfileDataJourneyReport=function(a,c){a="string"===typeof a?a:viewProfileId;c="string"===typeof c?c:currentJourneyMapId;loadTouchpointFlowForProfile(a,c);loadTouchpointHubReportForProfile(a,c);setTimeout(function(){$("#event_journey_funnel").empty();loadEventJourneyProfile(a,c)},700)},loadTouchpointHubReportForProfile=function(a,
c){$("#profileObserverChart").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-hub-report",{profileId:a,journeyMapId:c},function(b){if(0===b.httpCode&&""===b.errorMessage)if(b=b.data,0<b.length){var d=[],e=[];b.forEach(function(h){d.push(h.name);e.push(h.eventCount)});renderHorizontalBarChart("profileObserverChart",d,e)}else $("#profileObserverChart").html('\x3ch4 class\x3d"alert alert-info" role\x3d"alert"\x3e No data available \x3c/h4\x3e');
else LeoAdminApiUtil.logErrorPayload(b)})},loadProfileTopTouchpoints=function(){renderProfileTouchpointChart(viewProfileId,-1,0,100)},renderProfileTouchpointChart=function(a,c,b,d){$("#profileTouchpointChart").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/touchpoint-report",{profileId:a,touchpointType:c,startIndex:b,numberResult:d},function(e){if(0===e.httpCode&&""===e.errorMessage){e=e.data;var h=$("#engaged_touchpoint_list");
if(0<e.length){h.empty();var n=[],g=[];e.forEach(function(p){var f=p.touchpoint,k=textTruncate(f.name,60);n.push(k);g.push(p.eventCount);k=_.template($("#engaged-touchpoint-tpl").html());f.updatedAt=moment.utc(f.updatedAt).local().format("YYYY-MM-DD HH:mm:ss");f.truncatedUrl=textTruncate(f.url,120);""===f.locationCode&&(f.cssShowLocationCode="none");f.eventCount=p.eventCount;h.append(k(f))});renderHorizontalBarChart("profileTouchpointChart",n,g)}else $("#profileTouchpointChart").html("\x3ch4\x3e No data available \x3c/h4\x3e")}else LeoAdminApiUtil.logErrorPayload(e)})},
renderTaxonomyTextData=function(a){var c=$("#profileInJourneyMaps"),b=a.inJourneyMaps.length;a.inJourneyMaps.forEach(function(f){b--;var k=0<b,l="In journey map: "+f.name,q='\x3ci class\x3d"fa fa-map-o"\x3e\x3c/i\x3e '+f.name;l="\x3cb\x3e"+$('\x3ca class\x3d"btn btn-taxonomy btn-sm" /\x3e').attr("title",l).attr("href","#calljs-leoCdpRouter('Data_Journey_Map','"+f.id+"')").html(q)[0].outerHTML+"\x3c/b\x3e";k&&(l+=" ");""===f.queryHashedId&&c.append(l)});var d=$("#profileInSegments"),e=a.inSegments.length;
a.inSegments.forEach(function(f){e--;var k=0<e,l="In segment: "+f.name,q='\x3ci class\x3d"fa fa-users"\x3e\x3c/i\x3e '+f.name;f="\x3cb\x3e"+$('\x3ca class\x3d"btn btn-taxonomy btn-sm" /\x3e').attr("title",l).attr("href","#calljs-leoCdpRouter('Segment_Details','"+f.id+"')").html(q)[0].outerHTML+"\x3c/b\x3e";k&&(f+=" ");d.append(f)});var h=$("#profileDataLabels"),n=a.dataLabels.length;a.dataLabels.forEach(function(f){n--;var k='\x3ci class\x3d"fa fa-tag"\x3e\x3c/i\x3e '+f,l=0<n;f=$('\x3ca class\x3d"btn btn-taxonomy btn-sm" /\x3e').attr("title",
f).attr("href","#calljs-leoCdpRouter('Customer_Profile_Filter','"+f+"')").html(k)[0].outerHTML;l&&(f+=" ");h.append(f)});var g=$("#profileInAccounts"),p=a.inAccounts.length;a.inAccounts.forEach(function(f){p--;var k=0<p,l='\x3ci class\x3d"fa fa-object-group"\x3e\x3c/i\x3e '+f.name;f="\x3cb\x3e"+$('\x3ca class\x3d"btn btn-taxonomy btn-sm" /\x3e').attr("href","#calljs-leoCdpRouter('Account_Details','"+f.id+"')").html(l)[0].outerHTML+"\x3c/b\x3e";k&&(f+="; ");g.append(f)})},loadEventJourneyProfile=function(a,
c){var b=2*$("#event_journey_funnel").parent().width()/3;$("#event_journey_funnel_info").html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(baseLeoAdminUrl+"/cdp/analytics360/event-report/journey-profile",{profileId:a,journeyMapId:c},function(d){if(0===d.httpCode&&""===d.errorMessage){var e=d.data.total,h=0,n=d.data.funnelIndex;d.data.scoreCX&&(h=d.data.scoreCX.sentimentScore);var g=$("#profileJourneyFunnel");90<=n?g.attr("class","progress-bar progress-bar-striped active progress-bar-danger"):
50<=n&&90>n?g.attr("class","progress-bar progress-bar-striped active progress-bar-success"):g.attr("class","progress-bar progress-bar-striped active progress-bar-primary");$("#profileJourneySentimentScore").text(h);$("#profileJourneyFunnelValue").text(n);g.attr("aria-valuenow",n).css("width",n+"%");$("#profile_funnel_report \x3e div").removeClass("funnel-stage-active");h=Math.floor(n/10);for(n=1;n<=h;n++)$("#profile_funnel_stage_"+n).addClass("funnel-stage-active");0===h&&$("#profile_funnel_report_div").html('\x3cdiv class\x3d"list-group-item"\x3e No data available \x3c/div\x3e');
0==e?($("#event_journey_funnel_info").html('\x3cdiv class\x3d"list-group-item"\x3e No data available \x3c/div\x3e').show(),$("#journeyFlowChart").hide()):($("#event_journey_funnel_info").empty().hide(),$("#journeyFlowChart").show(),(new FunnelGraph({container:"#event_journey_funnel",gradientDirection:"vertical",data:{labels:journeyLabel5A,subLabels:["Behavioral Event"],colors:[["#9ACAEF","#67B0E9","#309EF3"]],values:d.data.reportData},displayPercent:!0,direction:"vertical",width:b,height:480,subLabelValue:"raw"})).draw())}else LeoAdminApiUtil.logErrorPayload(d)})},
loadTouchpointFlowForProfile=function(a,c){var b=$("#profileTouchpointFlow"),d=$("#profileTouchpointFlow_nodata"),e=baseLeoAdminUrl+"/cdp/analytics360/touchpoint-flow-report";a={profileId:a,journeyMapId:c,beginFilterDate:"",endFilterDate:""};b.html('\x3cdiv class\x3d"loader"\x3e\x3c/div\x3e');LeoAdminApiUtil.getSecuredData(e,a,function(h){0===h.httpCode&&""===h.errorMessage?(0<h.data.nodes.length?(b.empty().show(),d.hide()):(b.hide(),d.show()),window.profileTouchpointFlowObj=renderDirectedGraph("profileTouchpointFlow",
{nodes:h.data.nodes,edges:h.data.edges},h.data.rootNodeId)):LeoAdminApiUtil.logErrorPayload(h)})},profileInfoLoadProcessor=function(a){viewProfileId=a.id;a.fullName=""!==a.firstName||""!==a.lastName?a.firstName+" "+a.middleName+" "+a.lastName:"Web Visitor";a.typeAsText=a.typeAsText.replaceAll("_"," ");0>=a.age&&(a.age="-");""===a.livingLocation&&(a.livingLocation="_");""===a.primaryPhone&&(a.primaryPhone="-");""===a.firstName&&(a.firstName="-");""===a.lastName&&(a.lastName="-");""===a.primaryEmail&&
(a.primaryEmail="-");if("number"===typeof a.jobType){var c=a.jobType;a.jobTypeAsString=0===c?"UNSKILLED AND NON-RESIDENT":1===c?"UNSKILLED AND RESIDENT":2===c?"SKILLED":3===c?"HIGHLY SKILLED":"-"}a.funnelStage=a.funnelStage?a.funnelStage.toUpperCase():"-";a.lastTrackingEvent?(a.lastTrackingEvent.createdAt=moment.utc(a.lastTrackingEvent.createdAt).local().format("YYYY-MM-DD HH:mm:ss"),a.lastTrackingEvent.fingerprintId=a.lastTrackingEvent.fingerprintId?a.lastTrackingEvent.fingerprintId:"-",a.lastTrackingEvent&&
a.lastTrackingEvent.refTouchpoint&&(a.lastTrackingEvent.refTouchpoint.name=decodeURISafe(a.lastTrackingEvent.refTouchpoint.name))):a.lastTrackingEvent.createdAt="-";a.lastTouchpoint.name=decodeURISafe(a.lastTouchpoint.name);return a},loadProfileListByFilter=function(a,c,b,d,e,h,n){var g=[{data:"id"},{data:"firstName"},{data:"primaryEmail"},{data:"primaryPhone"},{data:"lastTouchpoint"},{data:"dataQualityScore"},{data:"totalLeadScore"},{data:"totalCLV"},{data:"updatedAt"},{data:"status"}],p=getUserSession();
return p?$(d).DataTable({lengthMenu:[[30,50,60],[30,50,60]],processing:!0,serverSide:!0,searching:!1,ordering:!0,serverMethod:"POST",ajax:{url:baseLeoAdminUrl+"/cdp/profiles/filter",contentType:"application/json",beforeSend:function(f){$(b).show();$(c).hide();f.setRequestHeader("leouss",p)},data:function(f){f=e(f);f.order.map(function(k){k.field=g[k.column]?g[k.column].data:""});return JSON.stringify(f)},dataSrc:function(f){var k=f.canInsertData,l=f.canEditData,q=f.canDeleteData;$(d).data("canInsertData",
k);$(d).data("canEditData",l);$(d).data("canDeleteData",q);"function"===typeof h&&h(f);$(b).hide();$(c).show();return f.data}},columnDefs:[{render:function(f,k,l){k="";"function"===typeof window[a]&&(k=getTableRowCheckedBox(a,d,f,!1));return k},targets:0,orderable:!1},{render:function(f,k,l){f="Web Visitor";var q="datatable_text no_contact";k="Data Profile of ";0<l.firstName.length||0<l.lastName.length?(q=l.firstName+" "+l.lastName,f=textTruncate(q,30),k+=q,q="datatable_text has_contact"):k+=f;l.dataVerification&&
(f='\x3ci class\x3d"fa fa-check-circle-o" aria-hidden\x3d"true" title\x3d"Verified Data" \x3e\x3c/i\x3e '+f,k="Verified "+k);return'\x3ca class\x3d"'+q+'" title\x3d"'+k+"\" href\x3d\"#calljs-leoCdpRouter('Customer_Profile_Info','"+(l.id+"')\" \x3e")+f+"\x3c/a\x3e"},targets:1,orderable:!1},{render:function(f,k,l){return"string"===typeof f?'\x3cdiv class\x3d"datatable_text "\x3e\x3ca title\x3d"'+(f+"\" href\x3d\"#calljs-leoCdpRouter('Customer_Profile_Info','"+(l.id+"')\" \x3e")+textTruncate(f,40)+"\x3c/a\x3e\x3c/div\x3e"):
"-"},targets:2,orderable:!1},{render:function(f,k,l){return"string"===typeof f?'\x3cdiv class\x3d"datatable_text"\x3e\x3ca title\x3d"'+(f+"\" href\x3d\"#calljs-leoCdpRouter('Customer_Profile_Info','"+(l.id+"')\" \x3e")+textTruncate(f,30)+"\x3c/a\x3e\x3c/div\x3e"):"-"},targets:3,orderable:!1},{render:function(f,k,l){"object"!==typeof l.lastTouchpoint&&(l.lastTouchpoint={name:"No data"});return'\x3cdiv style\x3d"font-size:11.4px;" title\x3d"'+l.lastTouchpoint.name+'"\x3e'+textTruncate(l.lastTouchpoint.name,
50)+"\x3c/div\x3e"},targets:4,orderable:!1},{render:function(f,k,l){k=(new Number(f)).toLocaleString();return 100>=f?'\x3cdiv class\x3d"datatable_text text-center"\x3e'+k+" \x3c/div\x3e":100<f&&250>f?'\x3cdiv class\x3d"highlight_text text-center profile_medium_score" \x3e'+k+"\x3c/div\x3e":'\x3cdiv class\x3d"highlight_text text-center profile_high_score"  \x3e'+k+"\x3c/div\x3e"},targets:5},{render:function(f,k,l){k=(new Number(f)).toLocaleString();return 20>f?'\x3cdiv class\x3d"datatable_text text-center"\x3e'+
k+" \x3c/div\x3e":20<=f&&100>f?'\x3cdiv class\x3d"highlight_text text-center profile_medium_score" \x3e'+k+"\x3c/div\x3e":100<=f?'\x3cdiv class\x3d"highlight_text text-center profile_high_score" \x3e'+k+"\x3c/div\x3e":'\x3cdiv class\x3d"highlight_text text-center" style\x3d"color:#404040!important;font-size:0.8em!important" \x3e'+k+" \x3c/div\x3e"},targets:6},{render:function(f,k,l){k=(new Number(f)).toLocaleString();return 20>f?'\x3cdiv class\x3d"datatable_text text-center"\x3e'+k+" \x3c/div\x3e":
20<=f&&100>f?'\x3cdiv class\x3d"highlight_text text-center profile_medium_score" \x3e'+k+"\x3c/div\x3e":100<=f?'\x3cdiv class\x3d"highlight_text text-center profile_high_score" \x3e'+k+" \x3c/div\x3e":'\x3cdiv class\x3d"highlight_text text-center" style\x3d"color:#404040!important;font-size:0.8em!important" \x3e'+k+" \x3c/div\x3e"},targets:7},{render:function(f,k,l){return f?'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff" \x3e'+moment.utc(f).local().format("YYYY-MM-DD - HH:mm:ss")+
"\x3c/div\x3e":"-"},targets:8},{render:function(f,k,l){k='\x3cmark\x3e\x3ci class\x3d"fa fa-check" aria-hidden\x3d"true"\x3e\x3c/i\x3e ACTIVE \x3c/mark\x3e';0===f?k='\x3ci class\x3d"fa fa-ban" aria-hidden\x3d"true"\x3e\x3c/i\x3e INACTIVE':-1===f?k='\x3ci class\x3d"fa fa-ban" aria-hidden\x3d"true"\x3e\x3c/i\x3e INVALID':-4===f&&(k='\x3ci class\x3d"fa fa-ban" aria-hidden\x3d"true"\x3e\x3c/i\x3e REMOVED');return'\x3cdiv class\x3d"small text-center" style\x3d"color:#3300ff!important" title\x3d"The status of Profile"\x3e'+
k+"\x3c/div\x3e"},targets:9},{render:function(f,k,l){f='\x3cdiv style\x3d"width:76px;"\x3e \x3ca class\x3d"control" title\x3d"View Profile Report" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Info\',\''+(l.id+'\')" \x3e \x3ci class\x3d"fa fa-info-circle" aria-hidden\x3d"true"\x3e\x3c/i\x3e View\x3c/a\x3e');$(d).data("canEditData")&&(f+=' \x3cbr\x3e\x3ca class\x3d"control" title\x3d"Edit Profile Data" href\x3d"#calljs-leoCdpRouter(\'Customer_Profile_Editor\',\''+(l.id+'\')" \x3e \x3ci class\x3d"fa fa-pencil-square-o" aria-hidden\x3d"true"\x3e\x3c/i\x3e Edit\x3c/a\x3e'));
"string"===typeof n&&(f+=n);return f+"\x3c/div\x3e"},targets:10}],columns:g,order:[[8,"desc"]]}):!1};
function loadDuplicatedProfiles(){selectedDuplicateProfileIdMap={};var a=LeoCdpAdmin.routerContext.dataObject,c=function(b){b.excludeProfileId=a.id;b.emails=5<a.primaryEmail.length?a.primaryEmail:"";b.emails=b.emails+";"+a.secondaryEmails.join(";");b.phones=3<a.primaryPhone.length?a.primaryPhone:"";b.phones=b.phones+";"+a.secondaryPhones.join(";");b.visitorId=1<a.visitorId.length?a.visitorId:"";b.crmRefId=1<a.crmRefId.length?a.crmRefId:"";b.fingerprintId=1<a.fingerprintId.length?a.fingerprintId:"";
b.lastSeenIp=1<a.lastSeenIp.length?a.lastSeenIp:"";b.lastUsedDeviceId=1<a.lastUsedDeviceId.length?a.lastUsedDeviceId:"";return b};!1!==duplicateProfileTable&&"object"===typeof duplicateProfileTable.ajax?duplicateProfileTable.ajax.reload():duplicateProfileTable=loadProfileListByFilter(!1,"#duplicate_profile_container","#duplicate_profile_loader","#duplicate_profile_table",c,!1,"")}function editCurrentProfile(){gotoLeoCdpRouter("Customer_Profile_Editor",viewProfileId)}
function onErrorLoadProfileInfo(a){$("#data_model_holder").html(getHtmlErrorPanel(a));$("#btn_refreshCurrentProfile,  #btn_refreshCurrentProfile, #btn_editCurrentProfile").attr("disabled","disabled")}function profileInfoGoBack(){loadProfileInfoOk?history.back():location.hash="calljs-leoCdpRouter('Profile_Management')"}
function loadProfile360Analytics(a,c,b){console.log("loadProfile360Analytics profileId:"+a+" crmRefId:"+c+" visitorId:"+b);loadProfileDataIntoDOM(!1,a,c,b,profileInfoLoadProcessor,function(){loadProfileInfoOk=!0;var d=LeoCdpAdmin.routerContext.dataObject;""!=d.primaryAvatar&&$("#profile_avatar").attr("src",d.primaryAvatar);var e="";e=d.dataVerification?'\x3ci class\x3d"fa fa-check-circle-o" aria-hidden\x3d"true" title\x3d"Verified Data" \x3e\x3c/i\x3e '+d.fullName:d.fullName;$("#profile_full_name").html(e);
renderTaxonomyTextData(d);loadEventsInProfileIndex=0;loadProfileDataJourneyReport();loadJourneyReportForProfile(d);initDateFilterComponent(!0,null,null,30);setTimeout(function(){loadFeedbacksInProfileIndex=0;loadFeedbackEventsInProfile()},5E3);setTimeout(function(){loadFinancialEventList()},7E3);e=$("#btn_profile_deduplicate");1===d.status?e.click(function(){deduplicateCurrentProfileDialog()}):e.attr("disabled","disabled");$("#profile_key_info").show();$("#profile_key_info_loader").hide();1!=d.status&&
$("#menu_duplicated_profiles").hide()},onErrorLoadProfileInfo)}
var saveProfileHandler=function(){iziToast.info({title:"Profile Editor",message:"System is processing ...",timeout:2E3});$("#data_model_holder").hide();$("#profile_editor_loader").show();$("#data_model_controller").find("button").attr("disabled","disabled");var a=buildUpdateProfileModel();console.log("buildUpdateProfileModel: ",a);a={objectJson:JSON.stringify(a)};LeoAdminApiUtil.callPostAdminApi("/cdp/profile/update",a,function(c){0===c.httpCode&&""!==c.data?(c=c.data,null!=c?(location.hash="calljs-leoCdpRouter('Customer_Profile_Info','"+
c+"')",notifySavedOK("Profile")):console.error("saveProfileHandler ",c)):LeoAdminApiUtil.logErrorPayload(c)})},formatSelectionList=function(a){$(a+":checked").parent().addClass("data_field");$(a).click(function(){$(a).parent().removeClass("data_field");$(this).parent().addClass("data_field")})},loadProfileData=function(a){$("#data_model_holder").hide();$("#profile_editor_loader").show();loadProfileDataIntoDOM(!0,a,!1,!1,function(c){var b=!1;c.dateOfBirth?b=c.dateOfBirth:0<c.age&&(b=(new moment).subtract(c.age,
"years").toDate());var d={useCurrent:!1,format:"YYYY-MM-DD"};!1!==b&&(d.defaultDate=moment.utc(b).local().format("YYYY-MM-DD"));$("#profileDateOfBirth").datetimepicker(d).on("dp.change",function(e){e=moment().diff(e.date,"years");$("#profileAge").val(e)});return c},function(){$("#data_model_holder").show();$("#profile_editor_loader").hide();editedProfileModel=LeoCdpAdmin.routerContext.dataObject;initProfileAvatarUploader(editedProfileModel);formatSelectionList('input[name\x3d"type"]');formatSelectionList('input[name\x3d"status"]');
formatSelectionList('input[name\x3d"gender"]');formatSelectionList('input[name\x3d"maritalStatus"]');"string"===typeof editedProfileModel.livingLocation&&$("#locationCodeSearch").attr("href","https://www.google.com/maps/?q\x3d"+editedProfileModel.livingLocation);$("#panel_profile_location").find('input[data-field\x3d"locationCode"]').change(function(){var b=$(this).val();0<=b.indexOf("\x3ciframe")&&(b=$(b).attr("src"),$(this).val(b))});$("#panel_profile_location").find('input[data-field\x3d"livingLocation"]').change(function(){var b=
encodeURIComponent($(this).val());$("#locationCodeSearch").attr("href","https://www.google.com/maps/?q\x3d"+b)});var c=!1;6===currentUserProfile.role&&($("#profileJourneyMapEditorRow").show(),loadDataJourneyMapEditor("#profileJourneyMapEditor",editedProfileModel.inJourneyMaps),c=!0);loadSystemUsersForDataAuthorization(c,editedProfileModel,$("#authorizedProfileViewers"),$("#authorizedProfileEditors"))})},buildUpdateProfileModel=function(){var a=$("#data_model_holder");a.find('input[data-field][type\x3d"radio"]:checked').each(function(){var c=
$(this).data("field"),b=$(this).data("fieldtype"),d=$(this).val();"int"===b?d=parseInt(d):"float"===b&&(d=parseFloat(d));editedProfileModel[c]=d});a.find('input[data-field][type\x3d"checkbox"]').each(function(){var c=$(this).data("field"),b=$(this).prop("checked");editedProfileModel[c]=b});a.find('input[data-field][type\x3d"text"],input[data-field][type\x3d"email"],textarea').each(function(){var c=$(this).data("field"),b=$(this).val();editedProfileModel[c]=b});a.find('input[data-field][type\x3d"tel"]').each(function(){var c=
$(this).data("field"),b=$(this).val().replace(/\D/g,"");editedProfileModel[c]=b});a.find('input[data-field][type\x3d"number"]').each(function(){var c=$(this).data("field"),b=$(this).data("fieldtype"),d=$(this).val();"int"===b?d=parseInt(d):"float"===b&&(d=parseFloat(d));editedProfileModel[c]=d});a.find("p[data-field][data-editable]").each(function(){var c=$(this).data("field"),b=$(this).data("fieldtype");if("hashset"===b){var d=[];$(this).find('input[type\x3d"text"]').each(function(){var n=$(this).data("fieldtype"),
g=$(this).val();"int"===n?g=parseInt(g):"float"===n&&(g=parseFloat(g));""!==g.trim()&&d.push(g);console.log(g)});editedProfileModel[c]=d}else if("hashmap"===b){var e={},h=$("#"+c).find("li");h.each(function(){var n=$(this).find("select").val(),g=$(this).find("input").val();""!=n.trim()&&""!=g.trim()&&(e[n]=g)});editedProfileModel[c]=e}else if("custom_field"===b||"custom_field_number"===b)e={},h=$(this).find("li"),h.each(function(){var n=$(this).find("input.custom_field_name").val().trim(),g=$(this).find("input.custom_field_value").val().trim();
"custom_field_number"===b&&(g=""===g?0:parseFloat(g));""!==n&&(e[n]=g)}),editedProfileModel[c]=e});a=$("#profileDateOfBirth").data("DateTimePicker").date();editedProfileModel.dateOfBirth=null!=a?(new moment.utc(a)).local():null;6===currentUserProfile.role&&(editedProfileModel.inJourneyMaps=getJourneyMapsFromEditor("#profileJourneyMapEditor",editedProfileModel.inJourneyMaps),editedProfileModel.authorizedViewers=$("#authorizedProfileViewers").val()||[],editedProfileModel.authorizedEditors=$("#authorizedProfileEditors").val()||
[]);return editedProfileModel},initProfileAvatarUploader=function(a){if(""===a.primaryAvatar||null==a.primaryAvatar){var c=baseLeoAdminUrl+"/public/images/avatars/profile-default-avatar.png";$("#profile_avatar_img").attr("src",c)}else c=a.primaryAvatar,$("#profile_avatar_img").attr("src",c),$("#profile_avatar_input").val(c);$("#profile_avatar_img").show();setupUploaderWidget("profile","avatar-"+a.id,"#profile_avatar_uploader",function(b){0<b.data.fileUrls.length&&(b=b.data.fileUrls[0],$("#profile_avatar_img").attr("src",
b),$("#profile_avatar_input").val(b))})},getSelectedJourneyData=function(a,c){for(var b=0;b<a.length;b++){var d=a[b];if(d.id===c.id)return d}return null},loadDataJourneyMapEditor=function(a,c){var b=$(a);LeoAdminApiUtil.getSecuredData("/cdp/journeymap/list-all",{},function(d){0===d.httpCode&&"object"===typeof d.data?(d.data.forEach(function(e){var h=e.id,n=e.name,g="";e=getSelectedJourneyData(c,e);null!=e?""===e.queryHashedId&&(g="selected"):e={scoreCX:{positive:0,neutral:0,negative:0,sentimentScore:0,
sentimentType:0,positivePercentage:0,neutralPercentage:0,negativePercentage:0,happy:!1},funnelIndex:1,id:h,name:n,type:0<editedProfileModel.type?"CONTACT":"VISITOR",indexScore:1,lastDataSynch:0,queryHashedId:""};e=encodeURIComponent(JSON.stringify(e));b.append('\x3coption id\x3d"profile_editor_journey_'+h+'" '+g+' value\x3d"'+h+'" data-json\x3d"'+e+'" \x3e'+n+"\x3c/option\x3e")}),b.chosen({width:"100%",no_results_text:"Oops, nothing found!"})):LeoAdminApiUtil.logErrorPayload(d)})},getJourneyMapsFromEditor=
function(a,c){var b=[];$(a).find("option").each(function(){var d=$(this).is(":selected");console.log($(this).val()+" selected "+d);var e=decodeURIComponent($(this).data("json"));e=JSON.parse(e);var h=getSelectedJourneyData(c,e);d?(e.queryHashedId="",b.push(e)):null!=h&&(h.queryHashedId="removed",b.push(h))});return b};