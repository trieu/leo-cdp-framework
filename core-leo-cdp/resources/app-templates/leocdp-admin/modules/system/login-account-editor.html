
<style>
div.panel_header {
	padding-bottom:10px;
}
.role-group-title {
    font-weight: 600;
    margin-top: 20px;
    margin-bottom: 10px;
    color: #333;
}
.role-item {
    padding: 8px 12px;
    border-radius: 4px;
    transition: background 0.2s;
}
.role-item:hover {
    background: #f7f7f7;
}
.role-separator {
    margin: 12px 0;
    border-color: #e5e5e5;
}
.sso-note {
    font-size: 13px;
    margin-top: 8px;
    color: #777;
}
</style>

<div class="container-fluid" id="user_login_editor_form" >

    <!-- MAIN BODY here -->
    <div class="row">
		<div class="col-lg-9">
			<h5 class="page-header" id="page_breadcrumb" > </h5>
		</div>
		<div class="col-lg-3 text-right" style="padding: 10px">
	     	<button type="button" class="btn btn-info" onclick="history.back()" title="Go back"  > 
	       		<i class="fa fa-arrow-circle-left" aria-hidden="true"></i> Back
	       	</button>
	       	<button type="button" class="btn btn-danger data-control-delete" onclick="deleteUserLoginAccount()" title="Delete Login Account" > 
	     		<i class="fa fa-trash" aria-hidden="true"></i> Delete 
	     	</button>
	       	<button type="button" class="btn btn-goto-router data-control-edit" onclick="saveUserProfile()" title="Save Login Account"  > 
	     		<i class="fa fa-check-square-o" aria-hidden="true"></i> Save 
	     	</button>
	     </div>
	</div>
	
	<h4> Account Editor for <span id="authorized_user_login" class="highlight_text"></span> </h4>
	<hr>
	<div id="error-on-save" class="alert alert-danger" style="display: none;"></div>

    <!-- MAIN BODY here -->
    <div class="row">
        <div class="col-lg-12">
        	
        	<!--  Tab Navigation Items -->
		    <ul class="nav nav-tabs" data-tab-content="login_account_tabs" >
				<li class="active" >
					<a href="javascript:" data-target-tab="panel_login_account_tab_general" title="User Profile" > <i class="fa fa-info-circle" aria-hidden="true"></i> User Information</a>
		       	</li>
		       	<li >
					<a href="javascript:" data-target-tab="panel_login_account_role" title="Account Permission" > <i class="fa fa-lock" aria-hidden="true"></i> User's Role</a>
		       	</li>
		       	<li data-for-superadmin="true" style="display: none;">
					<a href="javascript:loadAuthorizedJourneys()" data-target-tab="panel_login_account_authorized_journeys" title="Authorized Data Journey Maps" > <i class="fa fa-map-o" aria-hidden="true"></i> Journey Maps</a>
		       	</li>
		       	<li data-for-superadmin="true" style="display: none;">
					<a href="javascript:loadViewableProfiles()" data-target-tab="panel_login_account_viewable_profiles" title="Viewable Profiles" > <i class="fa fa-users" aria-hidden="true"></i> Viewable Profiles</a>
		       	</li>
		       	<li data-for-superadmin="true" style="display: none;">
					<a href="javascript:loadEditableProfiles()" data-target-tab="panel_login_account_editable_profiles" title="Editable Profiles" > <i class="fa fa-users" aria-hidden="true"></i> Editable Profiles</a>
		       	</li>
		       	<li data-for-superadmin="true" style="display: none;">
					<a href="javascript:loadViewableSegments()" data-target-tab="panel_login_account_viewable_segments" title="Viewable Segments" > <i class="fa fa-object-group" aria-hidden="true"></i> Viewable Segments</a>
		       	</li>
		       	<li data-for-superadmin="true" style="display: none;">
					<a href="javascript:loadEditableSegments()" data-target-tab="panel_login_account_editable_segments" title="Editable Segments" > <i class="fa fa-object-group" aria-hidden="true"></i> Editable Segments</a>
		       	</li>
		  	</ul>
		  	
		  	<!-- Tab Contents  -->
	    	<div id="login_account_tabs" class="tab-content" style="min-height: 820px;"  >
	    		<!-- BEGIN Tab Contents  -->
	    	
	    		<!-- tab 1 General Login Information  -->
				<div class="tab-pane active" id="panel_login_account_tab_general" >
  					<h4 class="highlight_text">
					    <i class="fa fa-info-circle" aria-hidden="true"></i> User Information
					</h4>
					
					<!-- Display Name -->
					<div class="form-group">
					    <label class="control-label" for="displayName">
					    	<i class="fa fa-id-card"></i> Display Name (Required)
					    </label>
					    <input type="text" 
					    	   id="displayName"
					           class="form-control"
					           placeholder="Enter display name"
					           name="displayName"
					           autocorrect="off"
					           autocapitalize="off"
					           autocomplete="off"
					           required>
					</div>

					<!-- SSO Source (Read-Only, Inline) -->
					<div class="form-group" id="sso_source_panel">
					    <label class="control-label"> 
					    	<i class="fa fa-key" aria-hidden="true"></i> 
					    		Keycloak SSO Source
					    </label>
					    <p class="form-control-static" style="margin-left:15px;">
					        <strong>URL:</strong> <span id="ssoSourceUrl"></span> —
					        <strong>Realm:</strong> <span id="ssoSourceRealm"></span> —
					        <strong>Client:</strong> <span id="ssoSourceClient"></span>
					    </p>
					</div>

					<!-- User Login -->
					<div class="form-group">
					    <label for="login_account_userLogin" class="control-label"> 
					    	<i class="fa fa-user"></i>
					    	User Login (Required)
					    </label>
					    <input id="login_account_userLogin"
					           data-validation="length alphanumeric"
					           data-validation-length="min4"
					           type="text"
					           class="form-control"
					           placeholder="Enter user login"
					           name="userLogin"
					           autocomplete="off"
					           autocorrect="off"
					           autocapitalize="none"
					           spellcheck="false"
					           required>
					</div>
					<!-- Email -->
					<div class="form-group">
					    <label class="control-label" for="userEmail">
					    	<i class="fa fa-envelope" aria-hidden="true"></i>
					    	Email Address (Required)
					    </label>
					    <input data-validation="email"
					    	   id="userEmail"
					           type="email"
					           class="form-control"
					           placeholder="Enter email address"
					           name="userEmail"
					           autocorrect="off"
					           autocapitalize="off"
					           autocomplete="off"
					           required>
					</div>

					<!-- Password + Show/Hide Toggle (Now inline) -->
					<div class="form-group" id="user_password_panel">
					    <label for="login_account_userPass" class="control-label">Login Password</label>
					    <div class="input-group">
					        <input id="login_account_userPass"
					               type="text"
					               class="form-control"
					               placeholder="Enter new password"
					               name="userPass"
					               autocorrect="off"
					               autocapitalize="off"
					               autocomplete="off">
					        <span class="input-group-addon">
					            <input id="showLoginAccountPassword"
					                   type="checkbox"
					                   onclick="showLoginAccountPassword('login_account_userPass')">
					        </span>
					        <span class="input-group-addon">Hide Password</span>
					    </div>
					</div>
					
					<hr>

					<!-- User Status (inline radios) -->
					<div class="form-group">
					    <label class="control-label">
					    	<i class="fa fa-key" aria-hidden="true"></i>
					    	User Status
					    </label>
					    <div class="radio-inline">
					        <label><input type="radio" name="status" value="1"> 
					        	<i class="fa fa-check-circle text-success"></i> Active
					        </label>
					    </div>
					    <div class="radio-inline">
					        <label><input type="radio" name="status" value="0"> 
					        	<i class="fa fa-clock-o text-warning"></i> Pending
					        </label>
					    </div>
					    <div class="radio-inline">
					        <label><input type="radio" name="status" value="2"> 
					        	<i class="fa fa-ban text-danger"></i> Disabled
					        </label>
					    </div>
					</div>
					
					<hr>

					<!-- Business Unit -->
					<div class="form-group">
					    <label class="control-label" for="businessUnit">
					    	<i class="fa fa-building"></i> Team / Business Unit (Required)
					    </label>
					    <input id="businessUnit"
					           type="text"
					           class="form-control"
					           placeholder="Enter team or business unit"
					           name="businessUnit"
					           autocorrect="off"
					           autocapitalize="off"
					           autocomplete="off"
					           required>
					</div>

					<!-- Groups -->
					<div class="form-group">
					    <label class="control-label" for="inGroups">
					    	<i class="fa fa-users"></i> Departments / User Groups
					    </label>
					    <select name="inGroups"
					            data-placeholder="Select one or more departments"
					            class="select"
					            multiple="multiple">
					        <option value="bod">Board of Directors (BOD)</option>
					        <option value="investor">Investor</option>
					        <option value="data_engineering_team">Data Engineering</option>
					        <option value="data_science_team">Data Science</option>
					        <option value="devops_team">DevOps / DataOps</option>
					        <option value="ai_team">AI Team</option>
					        <option value="marketing">Marketing</option>
					        <option value="market_research">Market Research</option>
					        <option value="finance">Finance</option>
					        <option value="accounting">Accounting</option>
					        <option value="audit">Auditing</option>
					        <option value="biz_operation">Business Operations</option>
					        <option value="pr_operation">PR Operations</option>
					        <option value="product_operation">Product Operations</option>
					        <option value="engineering">Product Engineering</option>
					        <option value="product_rnd">Product Research & Development</option>
					        <option value="logistics">Logistics / Product Delivery</option>
					        <option value="customer_support">Customer Support</option>
					        <option value="trading">Trading</option>
					        <option value="purchasing">Purchasing</option>
					        <option value="sales_team">Sales Team</option>
					        <option value="tech">IT / Technology Support</option>
					        <option value="media_agency">Media Marketing Agency</option>
					        <option value="sales_agent">Sales Agent / Representative</option>
					    </select>
					</div>

					<!-- Job Title -->
					<div class="form-group">
					    <label class="control-label" for="customData_position">
					    	<i class="fa fa-briefcase"></i> Job Title / Position
					    </label>
					    <input id="customData_position"
					           type="text"
					           class="form-control"
					           placeholder="Enter job title"
					           name="customData_position"
					           autocorrect="off"
					           autocapitalize="off"
					           autocomplete="off">
					</div>
  					
	                
	                <!-- Job Title -->
					<div class="form-group" id="profileVisitorId_panel" style="display: none">
					    <label class="control-label" for="profileVisitorId">
					    	<i class="fa fa-user"></i> 
					    	CDP Visitor ID <br>
					    	<a id="profileVisitorId_label_link" href="javascript:" target="_blank" > (Click to view) </a>   
					    </label>
					    <input id="profileVisitorId"
					           type="text"
					           class="form-control"
					           name="profileVisitorId"
					           autocorrect="off"
					           autocapitalize="off"
					           autocomplete="off"
					           readonly="readonly"
					           >
					</div>
				</div>
				
				<!-- tab 2 Account Permissions  -->
				<div class="tab-pane" id="panel_login_account_role" >
					

					    <h4 class="highlight_text">
					        <i class="fa fa-lock" aria-hidden="true"></i>
					        User Role & Permissions
					    </h4>
					
					    <!-- Viewer Roles -->
					    <div class="role-group-title">Viewer Access</div>
					
					    <div class="radio role-item">
					        <label>
					            <input type="radio" name="role" value="0">
					            <b>Report Viewer</b> — View dashboards and summary reports in the Unified Analytics Hub.
					        </label>
					    </div>
					
					    <div class="radio role-item" style="display: none">
					        <label>
					            <input type="radio" name="role" value="1">
					            <b>Customer Data Viewer</b> — View authorized customer profiles, segments, and insights.
					        </label>
					    </div>
					
					    <div class="radio role-item" style="display: none">
					        <label>
					            <input type="radio" name="role" value="2">
					            <b>Standard User</b> — Access Unified Analytics Hub and view authorized customer data.
					        </label>
					    </div>
					
					    <hr class="role-separator">
					
					    <!-- Editor / Operator Roles -->
					    <div class="role-group-title">Editor & Operator Access</div>
					
					    <div class="radio role-item">
					        <label>
					            <input type="radio" name="role" value="3">
					            <b>Customer Data Editor</b> — Manage authorized customer profiles and customer segments.
					        </label>
					    </div>
					
					    <div class="radio role-item">
					        <label>
					            <input type="radio" name="role" value="4">
					            <b>Data Operator</b> — Access Unified Analytics Hub, manage Journey Data Hub, and update customer profiles.
					        </label>
					    </div>
					
					    <hr class="role-separator">
					
					    <!-- Admin Roles -->
					    <div class="role-group-title">Administrative Access</div>
					
					    <div class="radio role-item">
					        <label>
					            <input type="radio" name="role" value="5">
					            <b>Data Admin</b> — Full permissions for customer data, Data Assets, and Data Services.
					        </label>
					    </div>
					
					    <div class="radio role-item">
					        <label>
					            <input type="radio" name="role" value="6">
					            <b>Super Admin</b> — Full system-wide access, including user management and system configuration.
					        </label>
					    </div>
					
						<hr>
						<p class="sso-note">
						    When a user is created automatically through Keycloak SSO, LEO CDP converts the Keycloak role
						    into an internal permission tier using the following mapping:
						</p>
						
						<ul class="sso-note" style="margin-left:20px;">
						    <li><strong>LEOCDP_SUPER_SYSTEM_ADMIN → SUPER ADMIN</strong></li>
						    <li><strong>LEOCDP_DATA_ADMIN → DATA ADMIN</strong></li>
						    <li><strong>LEOCDP_DATA_OPERATOR → DATA OPERATOR</strong></li>
						    <li><strong>LEOCDP_CUSTOMER_DATA_EDITOR → CUSTOMER DATA EDITOR</strong></li>
						    <li><strong>LEOCDP_REPORT_VIEWER → REPORT VIEWER</strong></li>
						</ul>
						
				</div>
				
				<!-- tab 3 authorized journeys  -->
				<div class="tab-pane" id="panel_login_account_authorized_journeys" >
					 
					<div class="col-lg-12 panel_header" >
						<div class="col-lg-10" >
						 	<h4 class="highlight_text"> <i class="fa fa-map-o" aria-hidden="true"></i> Authorized Data Journey Maps </h4>
						</div>
						<div class="col-lg-2" style="text-align: right;margin-top: 10px;">
						 	<button type="button" class="btn btn-danger" onclick="removeUserDataAuthorization('removeAllAuthorizedJourneys','authorized_journeys')" >
						 		<i class="fa fa-fw fa-trash"></i> Remove All
							</button>
						</div>
					</div>
					
					<div id="authorized_journeys_loader" class="loader"></div>
					<div id="authorized_journeys" style="display: none;" >	
					    <!-- authorized journey list -->
						<div class="row gridholder">
						    <div class="col-lg-12">
						    	
						    	<div class="checkbox">
								  <label style="font-weight: bold;">
								  	<input type="checkbox" id="updateAllProfilesInJourney" checked="checked"> Update user authorization for all profiles in the updated journey map
								  </label>
								</div>
						        <div class="table-responsive">
						            <table id="authorized_journeys_table" class="display" style="width:100%;">
						                <thead>
						                    <tr>
						                        <th class="text-center">Journey Name</th>
						                        <th class="text-center">Can View Data</th>
						                        <th class="text-center">Can Edit Data</th>
						                        <th class="text-center">Created Time</th>
						                        <th class="text-center">Updated Time</th>
						                        <th class="text-center">Default Event Metric</th>
						                        <th class="text-center">Actions</th>
						                    </tr>
						                </thead>
						            </table>
						        </div>
						        
						    </div>
						</div>
					</div> 
					 
				</div>
				
				
				<!-- tab 4 Viewable Profiles  -->
				<div class="tab-pane" id="panel_login_account_viewable_profiles" >
					
					<div class="col-lg-12 panel_header" >
						<div class="col-lg-10" >
						 	<h4 class="highlight_text"> <i class="fa fa-users" aria-hidden="true"></i> Viewable Customer Profiles </h4>
						</div>
						<div class="col-lg-2" style="text-align: right;margin-top: 10px;">
						 	<button type="button" class="btn btn-danger" onclick="removeUserDataAuthorization('removeAllViewableProfiles','viewable_profile_list')" >
						 		<i class="fa fa-fw fa-trash"></i> Remove All
							</button>
						</div>
					</div>
					
					<div id="viewable_profile_list_loader" class="loader"></div>
					<div id="viewable_profile_list" style="display: none;" >	
					    <!-- viewable profile list -->
						<div class="row gridholder">
						    <div class="col-lg-12">
						        <div class="table-responsive">
						            <table id="viewable_profile_list_table" class="display" style="width:100%;">
						                <thead>
						                    <tr>
						                        <th></th>
						                        <th> Full Name </th>
						                        <th class="text-center">Email</th>
						                        <th class="text-center">Phone</th>
						                        <th class="text-center">Last-seen Touchpoint</th>
						                        <th class="text-center">Data Quality</th>
						                        <th class="text-center">Lead Score</th>
						                        <th class="text-center">CLV Score</th>	                        
						                        <th class="text-center">Updated</th>
						                        <th class="text-center">Status</th>
						                        <th class="text-center">Actions</th>
						                    </tr>
						                </thead>
						            </table>
						        </div>
						    </div>
						</div>
					</div> 
				</div>
				
				<!-- tab 5 Editable Profiles -->
				<div class="tab-pane" id="panel_login_account_editable_profiles" >
					
					<div class="col-lg-12 panel_header" >
						<div class="col-lg-10" >
						 	<h4 class="highlight_text"> <i class="fa fa-users" aria-hidden="true"></i> Editable Customer Profiles </h4>
						</div>
						<div class="col-lg-2" style="text-align: right;margin-top: 10px;">
						 	<button type="button" class="btn btn-danger" onclick="removeUserDataAuthorization('removeAllEditableProfiles','editable_profile_list')"  >
						 		<i class="fa fa-fw fa-trash"></i> Remove All
							</button>
						</div>
					</div>
					
					<div id="editable_profile_list_loader" class="loader"></div>
					<div id="editable_profile_list" style="display: none;" >	
					    <!-- editable profile list -->
						<div class="row gridholder">
						    <div class="col-lg-12">
						        <div class="table-responsive">
						            <table id="editable_profile_list_table" class="display" style="width:100%;">
						                <thead>
						                    <tr>
						                        <th></th>
						                        <th> Full Name </th>
						                        <th class="text-center">Email</th>
						                        <th class="text-center">Phone</th>
						                        <th class="text-center">Last-seen Touchpoint</th>
						                        <th class="text-center">Data Quality</th>
						                        <th class="text-center">Lead Score</th>
						                        <th class="text-center">CLV Score</th>	                        
						                        <th class="text-center">Updated</th>
						                        <th class="text-center">Status</th>
						                        <th class="text-center">Actions</th>
						                    </tr>
						                </thead>
						            </table>
						        </div>
						    </div>
						</div>
					</div> 
				</div>
				
				<!-- tab 6 Viewable Segment -->
				<div class="tab-pane" id="panel_login_account_viewable_segments" >
					
					<div class="col-lg-12 panel_header" >
						<div class="col-lg-10" >
						 	<h4 class="highlight_text"> <i class="fa fa-object-group" aria-hidden="true"></i> Viewable Segments </h4>
						</div>
						<div class="col-lg-2" style="text-align: right;margin-top: 10px;">
						 	<button type="button" class="btn btn-danger" onclick="removeUserDataAuthorization('removeAllViewableSegments','viewable_segment_list')" >
						 		<i class="fa fa-fw fa-trash"></i> Remove All
							</button>
						</div>
					</div>
					
					<div id="viewable_segment_list_loader" class="loader"></div>
					<div id="viewable_segment_list" style="display: none;" >	
					    <!-- viewable segment list -->
						<div class="row gridholder">
						    <div class="col-lg-12">
						        <div class="table-responsive">
						            <table id="viewable_segment_list_table" class="display" style="width:100%;">
						                <thead>
						                    <tr>
						                    	<th></th>
						                        <th>Segment Name</th>
						                        <th>Total Profile</th>
							                    <th>Description</th>
							                    <th>Data Owner</th>
							                    <th>Created at</th>
							                    <th>Updated at</th>
							                    <th>Actions</th>
						                    </tr>
						                </thead>
						            </table>
						        </div>
						    </div>
						</div>
					</div> 
				</div>
				
				<!-- tab 7 Editable Segments -->
				<div class="tab-pane" id="panel_login_account_editable_segments" >
					
					<div class="col-lg-12 panel_header" >
						<div class="col-lg-10" >
						 	<h4 class="highlight_text"> <i class="fa fa-object-group" aria-hidden="true"></i> Editable Segments </h4>
						</div>
						<div class="col-lg-2" style="text-align: right;margin-top: 10px;">
						 	<button type="button" class="btn btn-danger" onclick="removeUserDataAuthorization('removeAllEditableSegments','editable_segment_list')" >
						 		<i class="fa fa-fw fa-trash"></i> Remove All
							</button>
						</div>
					</div>
					
					<div id="editable_segment_list_loader" class="loader"></div>
					<div id="editable_segment_list" style="display: none;" >	
					    <!-- editable profile list -->
						<div class="row gridholder">
						    <div class="col-lg-12">
						        <div class="table-responsive">
						            <table id="editable_segment_list_table" class="display" style="width:100%;">
						                <thead>
						                    <tr>
						                    	<th></th>
						                        <th>Segment Name</th>
						                        <th>Total Profile</th>
							                    <th>Description</th>
							                    <th>Data Owner</th>
							                    <th>Created at</th>
							                    <th>Updated at</th>
							                    <th>Actions</th>
						                    </tr>
						                </thead>
						            </table>
						        </div>
						    </div>
						</div>
					</div> 
				</div>
				<!-- END Tab Contents  -->
	    	</div>

        </div>
    </div>
</div>

<hr>

<script>
    
	var userLoginModel = false;

    var initUserLoginEditor = function(key) {
    	 var isUpdateData = key !== 'newuser';
    	 setupTabPanels(isUpdateData);    	 
    	 loadUserProfile(isUpdateData, key);
    }

    function loadUserProfile(isUpdateData, key) {
    	 var urlStr = baseLeoAdminUrl + '/user/get';
         var params = { 'key': key || 'newuser' };
         LeoAdminApiUtil.callPostAdminApi(urlStr, params, function (json) {
             if (json.httpCode === 0 && json.errorMessage === '') {
                 if (json.data) {
                     userLoginModel = json.data;
                     var date = LeoAdminApiUtil.formater.toDateString(userLoginModel.creationTime);

                     var node = $('#user_login_editor_form');
                     if (typeof userLoginModel.key === 'string') {
                         node.find('input[name="userLogin"]').val(userLoginModel.userLogin).attr('disabled', '');
                         node.find('input[name="status"][value=' + userLoginModel.status + ']').attr('checked', '');
                         node.find('input[name="role"][value=' + userLoginModel.role + ']').attr('checked', '');
                     } else {
                         node.find('input[name="userLogin"]').val(userLoginModel.userLogin);
                         node.find('input[name="status"][value=1]').attr('checked', '');
                         node.find('input[name="role"][value=1]').attr('checked', '');
                     }
                     node.find('input[name="displayName"]').val(userLoginModel.displayName);
                     node.find('input[name="userEmail"]').val(userLoginModel.userEmail);
                     
                     // SSO data render
                     var ssoSourceTokens = (userLoginModel.ssoSource || "").split("#")
                     if(ssoSourceTokens.length === 3){
                    	 $('#user_password_panel').hide()
                    	 $('#ssoSourceUrl').text(ssoSourceTokens[0]);
                         $('#ssoSourceRealm').text(ssoSourceTokens[1]);
                         $('#ssoSourceClient').text(ssoSourceTokens[2]);
                         $('#userEmail').attr('readonly','readonly');// email is managed by Keycloak
                     }
                     else {
                    	 $('#sso_source_panel').hide()
                     }
                     
                     // CDP profile is linked to the system user using profileVisitorId
                     var vid = userLoginModel.profileVisitorId || '';
                     if(vid !== ''){
                     	$('input[name="profileVisitorId"]').val(vid);
		  			 	var url = "#calljs-leoCdpRouter('Customer_Profile_Info_By_Visitor_ID','"+vid+"')";
		  			 	$('#profileVisitorId_label_link').attr('href',url);
		  			 	$('#profileVisitorId_panel').show();
		  			 }
                   
                     //customData
                     var position = userLoginModel.customData.position ? userLoginModel.customData.position : '';
                     node.find('input[name="customData_position"]').val(position);

                     // load businessUnit in java template
                     var businessUnit = userLoginModel.businessUnit ? userLoginModel.businessUnit : '';
                     node.find('input[name="businessUnit"]').val(userLoginModel.businessUnit);

                     // inGroups
                     var inGroups = userLoginModel.inGroups ? userLoginModel.inGroups : [];
                     inGroups.forEach(function(e){
                    	 node.find('select[name="inGroups"] option[value="' + e + '"]').attr('selected', 'selected');
                     })
                     node.find('select[name="inGroups"]').chosen({
                         width: "100%",
                         no_results_text: "No data available!"
                     }).trigger("chosen:updated");                     

                     //can not delete superadmin
                     if(userLoginModel.userLogin === 'superadmin'){
                         $('#btn_delete').hide();                        
                     }
                     
                     // set authorized_user_login
                     if(isUpdateData){
                    	 $('#authorized_user_login').text('User Login: '+userLoginModel.userLogin);
                    	 $('#login_account_userPass').focus(function(){
                    		 $(this).attr('required','required')
                    	 });
                     }
                     else {
                    	 $('#authorized_user_login').text('New User Login');
                    	 $('#login_account_userPass').attr('required','required')
                     }
                     
                     // admin role can view and edit all data
                 	 if(userLoginModel.role >= 5){
                 		 $('div.panel_header').hide();
                 	 }
                     
                 	if(userLoginModel.userLogin === 'superadmin'){
            			$('button.data-control-delete').attr('disabled', 'disabled').attr('title','You can not delete Super Admin User!');
            		}
                 } 
             } else {
            	 notifyErrorMessage(json.errorMessage)
             }
         });
    }

    function saveUserProfile() {
        var node = $('#user_login_editor_form');
        userLoginModel.displayName = node.find('input[name="displayName"]').val();
        userLoginModel.userLogin = node.find('input[name="userLogin"]').val();
        userLoginModel.profileVisitorId = node.find('input[name="profileVisitorId"]').val();
        userLoginModel.userEmail = node.find('input[name="userEmail"]').val();
        userLoginModel.userPass = node.find('input[name="userPass"]').val();

        userLoginModel.status = parseInt(node.find('input[name="status"]:checked').val());
        userLoginModel.role = parseInt(node.find('input[name="role"]:checked').val());
        userLoginModel.businessUnit = node.find('input[name="businessUnit"]').val();
        userLoginModel.inGroups = JSON.stringify(node.find('select[name="inGroups"]').val());
        userLoginModel.customData.position = node.find('input[name="customData_position"]').val();
        
        // User Authorization
        userLoginModel.removeAllAuthorizedJourneys = node.data("removeAllAuthorizedJourneys") === true;
        userLoginModel.removeAllViewableProfiles = node.data("removeAllViewableProfiles") === true;
        userLoginModel.removeAllEditableProfiles = node.data("removeAllEditableProfiles") === true;
        userLoginModel.removeAllViewableSegments = node.data("removeAllViewableSegments") === true;
        userLoginModel.removeAllEditableSegments = node.data("removeAllEditableSegments") === true;
        
        userLoginModel.updateAllProfilesInJourney = $('#updateAllProfilesInJourney').prop("checked") === true;
        
        if( userLoginModel.removeAllAuthorizedJourneys !== true) {
        	 userLoginModel.updatedJourneyMaps = getUserLoginUpdatedJourneyMaps();
        }
        
        var urlStr = baseLeoAdminUrl + '/user/create';
        if (typeof userLoginModel.key === 'string') {
            urlStr = baseLeoAdminUrl + '/user/update';
        }

        var onSaveOk = function (data) {        	
        	notifySavedOK("User Login Account");
        	location.hash = "calljs-leoCdpRouter('User_Login_Management')";
        }

        LeoAdminApiUtil.callPostAdminApi(urlStr, userLoginModel, function (json) {
            if (json.httpCode === 0 && json.errorMessage === '') {
                if (json.data === '') {
                    $('#error-on-save').html('Data is not valid !').show().delay(6000).fadeOut('slow');
                } else {
                    onSaveOk(json.data);
                }
            } else {
                $('#error-on-save').html(json.errorMessage).show().delay(6000).fadeOut('slow');
                LeoAdminApiUtil.logErrorPayload(json);
            }
        });
    }

    function deleteUserLoginAccount() {
    	if(userLoginModel){
    		var result = confirm("Do you want to delete " + userLoginModel.displayName + " ?");
            if (result) {
                var onSaveOk = function (data) {
                    iziToast.info({
        	    	    title: 'Delete Login Account',
        	    	    onClosed: function(){
        	    	    	location.hash = "calljs-leoCdpRouter('User_Login_Management')";
        	    	    },
        	    	    message: "The account login is deleted successfully!",
        	    	    timeout: 3000
        	    	});
                }
                var urlStr = baseLeoAdminUrl + '/user/delete';
                LeoAdminApiUtil.callPostAdminApi(urlStr, userLoginModel, function (json) {
                    if (json.httpCode === 0 && json.errorMessage === '') {
                        if (json.data === '') {
                            $('#error-on-save').html('Data is not valid !').show().delay(6000).fadeOut('slow');
                        } else {
                            onSaveOk(json.data);
                        }
                    } else {
                        $('#error-on-save').html(json.errorMessage).show().delay(6000).fadeOut('slow');
                        LeoAdminApiUtil.logErrorPayload(json);
                    }
                });
            }
    	}
    }
    
    
    var viewableProfilesTable = false;
    function loadViewableProfiles() {
    	var userLogin = $('#user_login_editor_form').find('input[name="userLogin"]').val();
    	
    	var tableDomSel = "#viewable_profile_list_table";
    	var loaderDomSel = "#viewable_profile_list_loader";
    	var containerDomSel = "#viewable_profile_list";
    	
    	if(userLoginModel.role >= 5){
    		$(loaderDomSel).hide();
    		$(containerDomSel).html("<h3 class='highlight_text'>The admin account can view all profiles</h3>").show()
    	}
    	else if( $(tableDomSel).length === 1 ){
    		if(typeof viewableProfilesTable === "object"){
        		viewableProfilesTable.ajax.reload();
        	}
    		else if( $(tableDomSel).length === 1 ){
            	var profileFilterParams = function(d) {
            		d.authorizedViewer = userLogin;
            		return d;
            	}
            	viewableProfilesTable = loadProfileListByFilter("",containerDomSel, loaderDomSel, tableDomSel, profileFilterParams);
        	}
    	}
    }
    
    var editableProfilesTable = false;
    function loadEditableProfiles() {
    	var userLogin = $('#user_login_editor_form').find('input[name="userLogin"]').val();
    	var tableDomSel = "#editable_profile_list_table";
    	var loaderDomSel = "#editable_profile_list_loader";
    	var containerDomSel = "#editable_profile_list";
    	
    	if(userLoginModel.role >= 5){
    		$(loaderDomSel).hide();
    		$(containerDomSel).html("<h3 class='highlight_text'>The admin account can edit all profiles</h3>").show()
    	}
    	else if( $(tableDomSel).length === 1 ){
    		if(typeof editableProfilesTable === "object"){
        		editableProfilesTable.ajax.reload();
        	}
    		else if( $(tableDomSel).length === 1 ){
            	var profileFilterParams = function(d) {
            		d.authorizedEditor = userLogin;
            		return d;
            	}
            	editableProfilesTable = loadProfileListByFilter("",containerDomSel, loaderDomSel, tableDomSel, profileFilterParams);
        	}
    	}
    }
    
    var viewableSegmentsTable = false;
    function loadViewableSegments() {
    	var userLogin = $('#user_login_editor_form').find('input[name="userLogin"]').val();
    	var tableDomSel = "#viewable_segment_list_table";
    	var loaderDomSel = "#viewable_segment_list_loader";
    	var containerDomSel = "#viewable_segment_list";
    	
    	if(userLoginModel.role >= 5){
    		$(loaderDomSel).hide();
    		$(containerDomSel).html("<h3 class='highlight_text'>The admin account can view all segments</h3>").show()
    	}
    	else if( $(tableDomSel).length === 1 ){
    		if(typeof viewableSegmentsTable === "object"){
        		viewableSegmentsTable.ajax.reload();
        	}
    		else if( $(tableDomSel).length === 1 ){
            	var filterParams = function(d) {
            		d.authorizedViewer = userLogin;
            		return d;
            	}
            	viewableSegmentsTable = loadSegmentListByFilter(containerDomSel, loaderDomSel, tableDomSel, filterParams);
        	}
    	}
    }
    
    var editableSegmentsTable = false;
    var loadEditableSegments = function() {
    	var userLogin = $('#user_login_editor_form').find('input[name="userLogin"]').val();
    	var tableDomSel = "#editable_segment_list_table";
    	var loaderDomSel = "#editable_segment_list_loader";
    	var containerDomSel = "#editable_segment_list";
    	
    	if(userLoginModel.role >= 5){
    		$(loaderDomSel).hide();
    		$(containerDomSel).html("<h3 class='highlight_text'>The admin account can edit all segments</h3>").show()
    	}
    	else if( $(tableDomSel).length === 1 ){
    		if(typeof editableSegmentsTable === "object"){
        		editableSegmentsTable.ajax.reload();
        	}
        	else {
            	var filterParams = function(d) {
            		d.authorizedEditor = userLogin;
            		return d;
            	}
            	editableSegmentsTable = loadSegmentListByFilter(containerDomSel, loaderDomSel, tableDomSel, filterParams);
        	}
    	}
    }
    
    
    var authorizedJourneyTable = false;
    var userLoginViewableJourneyMaps = {}, userLoginEditableJourneyMaps = {};
    function loadAuthorizedJourneys(){
    	var userLogin = $('#user_login_editor_form').find('input[name="userLogin"]').val();
    	var tableDomSel = "#authorized_journeys_table";
    	var loaderDomSel = "#authorized_journeys_loader";
    	var containerDomSel = "#authorized_journeys";
    	
    	if(userLoginModel.role >= 5){
    		$(loaderDomSel).hide();
    		$(containerDomSel).html("<h3 class='highlight_text'>The admin account can view and edit all data journey maps</h3>").show()
    	}
    	else if( $(tableDomSel).length === 1 ){
    		if(typeof authorizedJourneyTable === "object"){
    			authorizedJourneyTable.ajax.reload();
        	}
        	else {
            	var filterParams = function(d) {
            		d.authorizedViewer = userLogin;
            		d.authorizedEditor = userLogin;
            		return d;
            	}
            	authorizedJourneyTable = loadDataJourneyMapsByFilter('journeyListRowHandler', containerDomSel, loaderDomSel, tableDomSel, filterParams, userLoginViewableJourneyMaps, userLoginEditableJourneyMaps);
        	}
    	}
    }
    
    var removeUserDataAuthorization = function(dataKey, containerId) {
    	$('#user_login_editor_form').data(dataKey, true);
    	$('#' + containerId).empty().html("<h3 class='highlight_text'>All data will be removed after click on the Save button</h3>");
    }
    
    function journeyListRowHandler(isSelected, selectedItemId){
    	console.log(isSelected + " journeyListRowHandler " + selectedItemId);
    	var toks = selectedItemId.split("-");
    	var journeyMapId = toks[0];
    	var type = toks[1];
    	if(type === "viewer") {
    		if(isSelected){
    			userLoginViewableJourneyMaps[journeyMapId] = true;
    		}
    		else {
        		userLoginViewableJourneyMaps[journeyMapId] = false;
        	}
    	}
    	if(type === "editor") {
    		if(isSelected){
    			userLoginEditableJourneyMaps[journeyMapId] = true;
    			userLoginViewableJourneyMaps[journeyMapId] = true;
    		}
    		else {
        		userLoginEditableJourneyMaps[journeyMapId] = false;
        	}
    	}
    }
    
    function getUserLoginUpdatedJourneyMaps(){
    	var map = {}; 
    	for(var k in userLoginViewableJourneyMaps) { 
    		if(userLoginViewableJourneyMaps[k]) {
    			map[k] = "viewer";
    		}
    		else {
    			map[k] = "";
    		}
    	} 
    	for(var k in userLoginEditableJourneyMaps) { 
    		var value = typeof map[k] === "string" ?  map[k] : '';
    		if(userLoginEditableJourneyMaps[k]) {
    			map[k] = value + " editor"; 
    		}
    		else {
    			map[k] = value;
    		}
    	}
    	return map;
    }
</script>