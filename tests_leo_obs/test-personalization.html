<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>LEO Personalization Manual Test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            background: #f5f7fa;
            color: #222;
        }

        header {
            background: #0d1117;
            color: #fff;
            padding: 16px 24px;
        }

        main {
            max-width: 1100px;
            margin: 24px auto;
            padding: 0 16px;
        }

        .card {
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 24px;
        }

        .control-panel {
            display: flex;
            gap: 12px;
            align-items: center;
            flex-wrap: wrap;
        }

        .control-panel input {
            padding: 10px;
            width: 260px;
            font-size: 14px;
        }

        .control-panel button {
            padding: 10px 16px;
            font-size: 14px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            background: #2563eb;
            color: #fff;
        }

        .personalization-zone {
            background: #ffffff;
            border: 2px dashed #3b82f6;
            border-radius: 8px;
            padding: 16px;
            margin-top: 32px;
        }

        footer {
            text-align: center;
            padding: 24px;
            color: #777;
        }
    </style>


</head>

<body>

    <header>
        <h1>LEO Personalization Demo</h1>
        <p>Manual Visitor & Event Control</p>
    </header>

    <main>

        <!-- ================= VISITOR ================= -->
        <section class="card">
            <h3>Set Visitor ID</h3>
            <div class="control-panel">
                <input id="leoVidInput" placeholder="Enter leo_vid (e.g. vid_123)" />
                <button onclick="applyVisitorId()">Apply Visitor ID</button>
            </div>
        </section>

        <!-- ================= ITEM VIEW ================= -->
        <section class="card">
            <h3>Simulate Item View</h3>
            <div class="control-panel">
                <input id="productIdsInput" placeholder="Enter productids (e.g. AAPL,MSFT,GOOG)" />
                <button onclick="simulateItemView()">Simulate Item View</button>
            </div>
            <p style="font-size:13px;color:#555;margin-top:8px">
                Comma-separated product IDs, sent as <code>productids[]</code>
            </p>
        </section>

        <!-- ================= PERSONALIZATION ================= -->
        <section class="personalization-zone">
            <strong>ðŸ”® Personalized Recommendations (LEO)</strong>
            <script id="leo_recommender_45ePNkROy1pGi5Dc6pDnn2"></script>
        </section>

    </main>

    <footer>
        LEO Activation â€¢ Manual Personalization Trigger
    </footer>




    <!-- ===================================================== -->
    <!-- MANUAL CONTROLS                                       -->
    <!-- ===================================================== -->
    <script>
        const OBSERVER_ID = "45ePNkROy1pGi5Dc6pDnn2";

        function applyVisitorId() {
            const vid = document.getElementById("leoVidInput").value.trim();
            if (!vid) return alert("leo_vid is required");
            localStorage.setItem("leo_vid", vid);

            document.querySelectorAll(`iframe[id^="${OBSERVER_ID}_leo_iframe_"]`).forEach(el => el.remove());

            renderLeoPersonalization();
        }

        function simulateItemView() {
            const productids = document.getElementById("productIdsInput").value.trim();
            if (!productids) return alert("productids required");

            LeoObserver.recordEventItemView(productids);
        }

        function renderLeoPersonalization() {
            LeoObserverProxy.synchLeoVisitorId(function (vid) {
                const anchorId = "leo_recommender_" + OBSERVER_ID;
                const cb = Math.floor(Math.random() * 100000);
                let src = "https://obs.example.com/ris/html/products";

                src += "?visid=" + encodeURIComponent(vid);
                src += "&obsid=" + OBSERVER_ID;
                src += "&tpurl=" + encodeURIComponent(location.href);
                src += "&cb=" + cb;

                const container = document.getElementById(anchorId).parentElement;
                const iframe = document.createElement("iframe");

                iframe.id = OBSERVER_ID + "_leo_iframe_" + cb;
                iframe.src = src;
                iframe.style = "width:100%;height:800px;border:none;";

                container.appendChild(iframe);
            });
        }
    </script>

    <!-- ===================================================== -->
    <!-- CDP OBSERVER BOOTSTRAP                                -->
    <!-- ===================================================== -->
    <script>
        (function () {
            // Observer ID
            window.leoObserverId = OBSERVER_ID;

            // Default batch size of Event Tracking
            window.leoObserverBatchSize = 10;

            // CDN of JS
            window.leoObserverLogDomain = "obs.example.com";
            window.leoObserverCdnDomain = "leocdp.example.com/public";

            // Data Touchpoint Metadata 
            window.srcTouchpointName = encodeURIComponent(document.title);
            window.srcTouchpointUrl = encodeURIComponent(location.href);

            // the main proxy CDP JS
            var leoproxyJsPath = '/js/leo-observer-src/leo.proxy.js';
            var src = location.protocol + '//' + window.leoObserverCdnDomain + leoproxyJsPath;
            var jsNode = document.createElement('script');
            jsNode.async = true; jsNode.defer = true; jsNode.src = src;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jsNode, s);
        })();

        var LeoObserver = {};

        LeoObserver.recordEventPageView = function (eventData) {
            LeoObserverProxy.recordViewEvent("page-view", eventData || {});
        };

        LeoObserver.recordEventItemView = function (productids) {
            LeoObserverProxy.recordViewEvent("item-view", {
                productids: productids,
                idtype: "TICKER"
            });
        };


        function leoObserverProxyReady() {
            // AUTO PAGE VIEW
            LeoObserver.recordEventPageView();

            // Sync visitor ID
            LeoObserverProxy.synchLeoVisitorId(function (vid) {
                console.log("Visitor synced:", vid);
            });
        }
    </script>

</body>

</html>